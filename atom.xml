<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Poet博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.loveyx815.cn/"/>
  <updated>2020-05-13T18:40:45.189Z</updated>
  <id>http://blog.loveyx815.cn/</id>
  
  <author>
    <name>Yonggang Shi</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>JVM-Java内存模型初识</title>
    <link href="http://blog.loveyx815.cn/2020/05/13/JVM/JVM-Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E5%88%9D%E8%AF%86/"/>
    <id>http://blog.loveyx815.cn/2020/05/13/JVM/JVM-Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E5%88%9D%E8%AF%86/</id>
    <published>2020-05-12T16:00:00.000Z</published>
    <updated>2020-05-13T18:40:45.189Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java内存模型（JMM）"><a href="#Java内存模型（JMM）" class="headerlink" title="Java内存模型（JMM）"></a>Java内存模型（JMM）</h1><blockquote><p>JMM 可以屏蔽掉各种硬件和操作系统的内存访问差异，让Java程序在各个平台下都能达到一致的内存访问效果。</p></blockquote><h2 id="1-主内存与工作内存"><a href="#1-主内存与工作内存" class="headerlink" title="1. 主内存与工作内存"></a>1. 主内存与工作内存</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://gitee.com/GAO13/PicGoRepo/raw/master/JMM内存图.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><blockquote><p>JMM规定所有的变量（包括实例变量、静态字段、构成数组对象的元素）都存储在主内存中，每个线程还有自己工作内存。线程工作内存保存了被该线程使用的变量的主内存的副本拷贝（不会拷贝整个对象，可能拷贝的是对象的引用、所对象访问的字段），线程对变量的操作都是在工作内存中进行，线程之间的值传递需要通过主内存完成。</p></blockquote><h2 id="2-内存间交互操作"><a href="#2-内存间交互操作" class="headerlink" title="2. 内存间交互操作"></a>2. 内存间交互操作</h2><blockquote><p>工作内存和主内存间的交互操作：一个变量如何从主内存拷贝到工作内存，在如何从工作内存同步到主内存。</p></blockquote><p><strong>JMM</strong>中定义了8中原子性操作来完成。</p><table><thead><tr><th>操作</th><th>含义</th><th>作用区域</th><th>作用</th></tr></thead><tbody><tr><td><code>lock</code></td><td>锁定</td><td>主内存变量</td><td>把一个变量标识为一条线程独占状态</td></tr><tr><td><code>unlock</code></td><td>解锁</td><td>主内存变量</td><td>把一个处于锁定的变量释放出来</td></tr><tr><td>read</td><td>读取</td><td>工作内存变量</td><td>把一个变量从主内存传输到线程的工作内存</td></tr><tr><td>load</td><td>载入</td><td>工作内存变量</td><td>把read操作的变量值放入工作内存副本中</td></tr><tr><td>`use</td><td>使用</td><td>工作内存变量</td><td>把工作内存中的一个变量的值传递给执行引擎，当JVM遇到一个需要变量的值得字节码指令时将会执行这个操作</td></tr><tr><td><code>assign</code></td><td>赋值</td><td>工作内存变量</td><td>把从执行引擎接受到的值给工作内存的变量，当JVM遇到一个给变量赋值的额字节码指定时执行该操作</td></tr><tr><td><code>store</code></td><td>存储</td><td>工作内存变量</td><td>把工作内存中的一个变量的值传递到主内存中</td></tr><tr><td><code>write</code></td><td>写入</td><td>主内存变量</td><td>把<code>store</code>操作传递的值放入工作内存的变量中</td></tr></tbody></table><ul><li>变量复制主内存-&gt;工作内存：顺序执行<code>read</code>、<code>load</code></li><li>变量同步工作内存-&gt;主内存：顺序执行store、<code>write</code></li></ul><p>上面两过程不要必须连续执行，只要顺序执行，且每个操作不得单独出现。</p><h2 id="3-Volatile登场"><a href="#3-Volatile登场" class="headerlink" title="3. Volatile登场"></a>3. Volatile登场</h2><ul><li>可见性</li></ul><p><code>volatile</code>修饰的变量，对所有的线程是可见的。即当一个线程修改了该变量，其他线程都是立即可见的。但是，并不表示<code>volatile</code>变量是支持线程安全的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">volatile</span>  <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span>  THREAD_COUNT = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Thread[] threads = <span class="keyword">new</span> Thread[THREAD_COUNT];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ;i&lt;THREAD_COUNT;i++)&#123;</span><br><span class="line">            threads[i]= <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++)&#123;</span><br><span class="line">                        increase();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            threads[i].start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//等待所有线程执行完毕</span></span><br><span class="line">        <span class="keyword">while</span> (Thread.activeCount()&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            Thread.yield();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>在这里定义了30个线程去累加count，每个线程加1000，理想在并发状态下得到的应该是<code>30000</code>，实际输出来看下</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://gitee.com/GAO13/PicGoRepo/raw/master/20200513174944.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>实际得到的数值会比预计的要小。</p><blockquote><p>由于这里使用<code>count++</code>来累加改变这个<code>volatile</code>变量，而自增操作并不是原子性的，即使<code>count</code>变量是所有线程可见，但不能保证在并发执行运算的时候，非原子性操作一定是读取的和和主内存变量同步的值。</p></blockquote><ul><li>禁止指令重排优化</li></ul><blockquote><p>普通变量仅仅能保证在执行该方法的过程中所有依赖赋值的地方能得到正确的结果，但不能保证程序一定按照代码的顺序执行</p></blockquote><p>看个伪代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个标识</span></span><br><span class="line"><span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"><span class="comment">//业务代码A</span></span><br><span class="line">service.changeState();</span><br><span class="line"><span class="comment">//业务代码执行完，改变flag</span></span><br><span class="line"> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//.....</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当flag为true时，执行另一段业务B</span></span><br><span class="line"><span class="keyword">while</span>(flag)&#123;</span><br><span class="line">    <span class="comment">//dosomething</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于系统有指令优化重排，获取<code>flag=true</code>可能会被提前执行，也就是在<code>业务A</code>没有执行情况下，就已经改变了flag。实际上我们想要的是在<code>业务A</code>执行完之后在区执行<code>flag=true</code>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个标识</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"><span class="comment">//业务代码A</span></span><br><span class="line">service.changeState();</span><br><span class="line"><span class="comment">//业务代码执行完，改变flag</span></span><br><span class="line"> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//.....</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当flag为true时，执行另一段业务B</span></span><br><span class="line"><span class="keyword">while</span>(flag)&#123;</span><br><span class="line">    <span class="comment">//dosomething</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>加了<code>volatile</code>就可以让代码按序执行</p><h2 id="4-先行发生原则（happents-before）"><a href="#4-先行发生原则（happents-before）" class="headerlink" title="4. 先行发生原则（happents-before）"></a>4. 先行发生原则（happents-before）</h2><blockquote><p>先行发生是JMM中定义的两项操作之间的偏序关系，如果说操作A先行于操作B发生，其实就是说在操作B发生之前，操作A产生的影响能被操作B观察到。</p></blockquote><p>这里的<code>影响</code>包括修改了内存中共享变量的值、发送了消息、调用了方法等。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//thread A 执行</span></span><br><span class="line">i=<span class="number">1</span>;</span><br><span class="line"><span class="comment">//thread B 执行</span></span><br><span class="line">j=i;</span><br><span class="line"><span class="comment">//thread C 执行</span></span><br><span class="line">i=<span class="number">4</span>;</span><br></pre></td></tr></table></figure><p>假设线程A会先于B执行，那么当只执行线程A、B时，A永远先于B执行，所以<code>j</code>一定等于1。若在A、B之间加入线程C执行，并没有规定C会先于B发生，所以此时<code>j</code>的值就会不确定，线程不安全。</p><p>下面介绍下Java中</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Java内存模型（JMM）&quot;&gt;&lt;a href=&quot;#Java内存模型（JMM）&quot; class=&quot;headerlink&quot; title=&quot;Java内存模型（JMM）&quot;&gt;&lt;/a&gt;Java内存模型（JMM）&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;JMM 可以屏蔽掉各种硬件
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="JVM" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/JVM/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="JVM" scheme="http://blog.loveyx815.cn/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>JVM-类加载机制初识</title>
    <link href="http://blog.loveyx815.cn/2020/05/10/JVM/JVM-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E5%88%9D%E8%AF%86/"/>
    <id>http://blog.loveyx815.cn/2020/05/10/JVM/JVM-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E5%88%9D%E8%AF%86/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-11T15:08:22.522Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JVM-类加载机制初识"><a href="#JVM-类加载机制初识" class="headerlink" title="JVM-类加载机制初识"></a>JVM-类加载机制初识</h1><h2 id="1-什么是类加载机制？"><a href="#1-什么是类加载机制？" class="headerlink" title="1. 什么是类加载机制？"></a>1. 什么是类加载机制？</h2><blockquote><p>我们所写的Java代码在经过编译后悔产生对应的class字节码文件，JVM把class文件加载到内存中，对数据进行校验、转换解析和初始化过程，最终形成可以被JVM直接使用的Java类型。</p></blockquote><ul><li>类加载的时机</li></ul><p>整个的生命周期：<code>加载</code>-<code>验证</code>-<code>准备</code>-<code>解析</code>-<code>初始化</code>-<code>使用</code>-<code>卸载</code></p><p><code>解析</code>的过程不一定会按部就班的按照上面的循序执行，有可能会在<code>初始化</code>阶段之后执行（通过动态绑定可以实现）</p><p><strong>需要开始类加载的5种情况：</strong></p><ol><li>遇到new、getstatic、putstatic、invokestatic这4条字节码指定时，若类没有进行初始化，则先触发初始化（如：使用new实例化对象、读取或设置一个类的静态字段，被final修饰的、在编译期就放入了常量池的静态字段除外，以及调用一个类的静态方法的时候）</li><li>使用<code>java.lang.refleact</code>反射，如果该类灭有初始化会进行初始化</li><li>初始化子类发现其父类还没初始化，则需要触发父类的初始化</li><li>JVM启动时，用户需要制定一个要执行的主类（包含main方法的那个类），JVM会先初始化这个主类。</li><li>如果一个<code>java.lang.invoke.MethodHeandle</code>实例最后解析结果<code>REF_getStatic</code>、<code>REF_putStatic</code>、<code>REF_invokeStatic</code> 的方法句柄，且这个方法句柄所对应的类没有进行过初始化，则需要进行初始化。</li></ol><h2 id="2-类加载的过程"><a href="#2-类加载的过程" class="headerlink" title="2. 类加载的过程"></a>2. 类加载的过程</h2><h3 id="1-加载"><a href="#1-加载" class="headerlink" title="1. 加载"></a>1. 加载</h3><ol><li>通过一个类全限定名来获取定义此类的二进制字节流（<code>可以通过多种方式，如反射、网络、其他文件JSP这样等等方式去获取字节流</code>）</li><li>将此字节流所代表的静态存储结构转化为方法区的运行时数据结构</li><li>在内存中生成一个代表这个类的<code>java.lang.Class</code>对象（Hotspot中该对象是分配在方法区中），作为方法区这个类的各种数据的访问入口</li></ol><h3 id="2-验证"><a href="#2-验证" class="headerlink" title="2. 验证"></a>2. 验证</h3><blockquote><p>验证是连接的第一阶段，目的是确保class文件的字节流的信息符合JVM的规范，不会危害到JVM。像数组越界操作之类的危害代码，可以手动植入到class文件中。</p></blockquote><ol><li>文件格式验证</li></ol><p>验证字节流是否符合Class文件格式的规范，并且能够被当前版本的JVM处理</p><ol start="2"><li>元数据验证</li></ol><p>对字节码描述的信息进行语义分析，保证符合Java语言规范的要求。</p><ol start="3"><li>字节码验证</li></ol><p>通过数据流和控制流的分析，确定程序语义是合法的、符合逻辑。这块的验证工作很复杂，JDK1.6后进行优化，对方法体的<code>Code</code>属性的属性表中增加了一个<code>StackMapTable</code>属性，记录了按照控制流拆分的代码块在开始时本地变量表和操作栈中应有的状态（验证无需进行推导验证只要检查该属性即可）</p><h3 id="3-准备"><a href="#3-准备" class="headerlink" title="3. 准备"></a>3. 准备</h3><p>为类变量分配内存并设置类变量（<code>static</code>修饰的变量）初始值。</p><h3 id="4-解析"><a href="#4-解析" class="headerlink" title="4. 解析"></a>4. 解析</h3><p>将常量池内的符号引用替换为直接引用。</p><p><strong>符号引用：</strong></p><blockquote><p>以一符号来描述所引用的目标，符号可以是任何形式的字面量。符号引用的目标不一定会加载入内存，可能不存在，定义在Class文件格式中</p></blockquote><p><strong>直接引用：</strong></p><blockquote><p>直接指向目标的指针、相对偏移量或是一个能间接定位到目标的句柄。直接引用的目标一定已经在内存中。</p></blockquote><p><code>细节待补充</code>！！！</p><h3 id="5-初始化"><a href="#5-初始化" class="headerlink" title="5. 初始化"></a>5. 初始化</h3><blockquote><p>在准备阶段，变量已经赋过一次系统要求的初始值（数据类型的默认值），在初始化阶段，根据程序中自定义的变量属性进行赋值。实际上就是执行类构造器<clinit>()方法。</p></blockquote><ul><li><clinit>()</li></ul><p><clinit>()方法由编译器自动收集类中的所有类变量的赋值动作和静态语句块（ <code>static{}</code> ）中的语句合并产生，收集的顺序是由语句在原文件中出现的顺序决定。静态语句块中只能访问到定义在静态语句块之前的变量，定义在他之后的变量，在前面的静态语句块可以赋值但不能访问。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        i = <span class="number">0</span>; <span class="comment">//正常编译通过</span></span><br><span class="line">        System.out.println(i);<span class="comment">//编译报错，非法向前引用</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;clinit&gt;()</code>方法不需要显示调用父类构造器，JVM会保证父类的</p><p><code>&lt;clinit&gt;()</code> 先执行。接口中<code>&lt;clinit&gt;()</code>只会在用到父接口的变量的时候才会去初始化<code>&lt;clinit&gt;()</code>。<code>&lt;clinit&gt;()</code>是现线程安全的，同一类初始化同时只会被一个线程操作。</p><h2 id="3-类加载器"><a href="#3-类加载器" class="headerlink" title="3. 类加载器"></a>3. 类加载器</h2><blockquote><p>让应用程序自己决定如何去获取所需要的类（<code>通过一个类的全限定名来获取描述此类的二进制字节流</code>），在JVM外部实现这动作，这就是类加载器所做的工作。</p></blockquote><h3 id="1-类与类加载器"><a href="#1-类与类加载器" class="headerlink" title="1. 类与类加载器"></a>1. 类与类加载器</h3><blockquote><p>对于任何一个类，需要有加载它的类加载器和这个类一同确立其在JVM中的唯一性。比较两个类是否相等，前提是两个类是同一类加载器所加载的。</p></blockquote><h3 id="2-双亲委派模型"><a href="#2-双亲委派模型" class="headerlink" title="2. 双亲委派模型"></a>2. 双亲委派模型</h3><ul><li>启动类加载器（Bootstrap ClassLoader）</li></ul><p>负责将放在<code>jdk\lib</code>目录下或者被<code>-Xbootclasspath</code>参数指定的路径中的，并且是JVM指定的名称类型加载到虚拟机内存中。</p><ul><li>扩展类加载器（Extension Classloader）</li></ul><p>负责加载<code>jdk\lib\ext</code>下或者被<code>java.ext.dirs</code>系统变量所指定的额路径的所有类库。</p><ul><li>应用程序类加载器</li></ul><p>该加载器是<code>ClassLoader</code> 中<code>getSystemClassLoader()</code>方法的返回值。负责加载用户类路径<code>ClassPath</code>上所指定的类库。</p><ul><li>双亲委派</li></ul><blockquote><p>如果一个类加载器收到类加载请求，他首先去吧请求委派给父类加载器去完成，当父类加载器无法加载或者抛出异常时，子类加载器才会去尝试加载。</p></blockquote><p>好处：维护了Java程序的稳定运作，避免多个类加载器调用同一个类A，会产生多个类A，会造成混乱。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;JVM-类加载机制初识&quot;&gt;&lt;a href=&quot;#JVM-类加载机制初识&quot; class=&quot;headerlink&quot; title=&quot;JVM-类加载机制初识&quot;&gt;&lt;/a&gt;JVM-类加载机制初识&lt;/h1&gt;&lt;h2 id=&quot;1-什么是类加载机制？&quot;&gt;&lt;a href=&quot;#1-什么是类
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="JVM" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/JVM/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="JVM" scheme="http://blog.loveyx815.cn/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>Nginx搭建&amp;不同域名代理同一服务器不同服务</title>
    <link href="http://blog.loveyx815.cn/2020/05/05/nginx/2020-05-05-Nginx%E6%90%AD%E5%BB%BA&amp;%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D%E4%BB%A3%E7%90%86%E5%90%8C%E4%B8%80%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8D%E5%90%8C%E6%9C%8D%E5%8A%A1/"/>
    <id>http://blog.loveyx815.cn/2020/05/05/nginx/2020-05-05-Nginx%E6%90%AD%E5%BB%BA&amp;%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D%E4%BB%A3%E7%90%86%E5%90%8C%E4%B8%80%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8D%E5%90%8C%E6%9C%8D%E5%8A%A1/</id>
    <published>2020-05-04T16:00:00.000Z</published>
    <updated>2020-05-05T14:54:25.343Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Nginx搭建、代理服务"><a href="#Nginx搭建、代理服务" class="headerlink" title="Nginx搭建、代理服务"></a>Nginx搭建、代理服务</h1><h2 id="一-环境搭建"><a href="#一-环境搭建" class="headerlink" title="一. 环境搭建"></a>一. 环境搭建</h2><ol><li>下载nginx<br>链接：<a href="https://pan.baidu.com/s/1b6PttHknU6bnxObJIYajyg" target="_blank" rel="noopener">https://pan.baidu.com/s/1b6PttHknU6bnxObJIYajyg</a><br>提取码：ce8y<br>也可以在线安装(我是直接离线安装的)<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.14.2.tar.gz</span><br></pre></td></tr></table></figure></li><li>解压<br>下载完后，通过ftp软件把我们刚刚下载的包传到我们的服务器上去<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200505220625535.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure>接着我们对该压缩文件进行解压，进入home文件夹（我是把nginx包放在home）<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.13.0.tar.gz</span><br></pre></td></tr></table></figure>解压完之后会在出现个nginx文件夹源代码 <code>nginx-1.13.0</code></li><li>编译环境<blockquote><p>在编译之前，我们还得要装一些依赖</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> nginx环境所需依赖</span></span><br><span class="line">yum -y install pcre*</span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx开启https的依赖</span></span><br><span class="line">yum -y install openssl*</span><br></pre></td></tr></table></figure>依赖解决完之后，我们来开始安装：<br>进入刚才解压的文件夹<code>nginx-1.13.0</code>中<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.执行文件，检查配置文件是否生效</span></span><br><span class="line">./configure </span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.编译源代码</span></span><br><span class="line">make </span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.安装</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>到这里，安装应该算基本完事。可以去<code>/usr/local/</code>下面看看是不是多了个<code>nginx</code>的文件夹<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200505221824712.png" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure>这里就是我们刚刚安装在系统里生成的nginx服务的文件夹了</li><li>运行nginx<br>进入<code>/usr/local/nginx/</code>，直接运行<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 因为nginx默认配置的是80端口，所以在运行前，先确认下服务器的80端口有没有被占用</span></span><br><span class="line">./nginx</span><br></pre></td></tr></table></figure>运行完之后，不出意外访问你的服务器ip就可以访问了<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200505222504238.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure><h2 id="二-用一个nginx配置不同域名访问不同服务"><a href="#二-用一个nginx配置不同域名访问不同服务" class="headerlink" title="二.用一个nginx配置不同域名访问不同服务"></a>二.用一个nginx配置不同域名访问不同服务</h2></li></ol><ul><li>场景描述：<blockquote><p>在当前服务器下，有两个域名 <a href="http://www.test1.com" target="_blank" rel="noopener">www.test1.com</a> 和<a href="http://www.test2.com都对这个服务器ip进行绑定。在服务器中搭建服务A、B，在不过代理访问的情况下，我所了解的是不能用两个域名直接就可以访问对应的服务。比如我访问www.test1.com就是A服务，www.test2.com就是B服务。" target="_blank" rel="noopener">www.test2.com都对这个服务器ip进行绑定。在服务器中搭建服务A、B，在不过代理访问的情况下，我所了解的是不能用两个域名直接就可以访问对应的服务。比如我访问www.test1.com就是A服务，www.test2.com就是B服务。</a></p></blockquote></li><li>解决方案：<br>为了解决上述的问题，这时候就得要代理访问了<br>打开<code>/usr/local/nginx/conf/nginx.conf</code>配置文件<br>贴上对应的配置：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">user  nobody;</span></span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">error_log  logs/error.log;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    </span><br><span class="line">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br><span class="line">    #                  '$status $body_bytes_sent "$http_referer" '</span><br><span class="line">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache's document root</span><br><span class="line">        # concurs with nginx's one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    #test1服务</span><br><span class="line">    server &#123;     </span><br><span class="line">                              listen      80;     </span><br><span class="line">                              server_name www.test1.com test1.com;     </span><br><span class="line">                              location / &#123;     </span><br><span class="line">                                          proxy_pass http://ip:9000/A/;     </span><br><span class="line">                              &#125;     </span><br><span class="line">                              error_page  500 502 503 504  /50x.html;   </span><br><span class="line">                              location = /50x.html &#123;       </span><br><span class="line">                                              root  html;     </span><br><span class="line">                              &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    #test2服务</span><br><span class="line">    server &#123;     </span><br><span class="line">                              listen      80;     </span><br><span class="line">                              server_name www.test2.com test2.com;     </span><br><span class="line">                              location / &#123;     </span><br><span class="line">                                          proxy_pass http://ip:9002/B/;     </span><br><span class="line">                              &#125;     </span><br><span class="line">                              error_page  500 502 503 504  /50x.html;   </span><br><span class="line">                              location = /50x.html &#123;       </span><br><span class="line">                                              root  html;     </span><br><span class="line">                              &#125;</span><br><span class="line">                              </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>通过两个<code>server</code>的配置，可以对两个域名进行代理。</p><ul><li>listen      代理对外暴露的端口（默认80）</li><li>server_name  你的域名访问的名称（所以在这里的<a href="http://www.test1.com能访问到我们要代理的地方）" target="_blank" rel="noopener">www.test1.com能访问到我们要代理的地方）</a></li><li>proxy_pass  我们要代理的url</li></ul><p>保存好配置文件后，在<code>nginx/sbin/</code>重新运行下nginx<code>./nginx -s reload</code>，这样我们的域名映射服务的需求就算完成了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Nginx搭建、代理服务&quot;&gt;&lt;a href=&quot;#Nginx搭建、代理服务&quot; class=&quot;headerlink&quot; title=&quot;Nginx搭建、代理服务&quot;&gt;&lt;/a&gt;Nginx搭建、代理服务&lt;/h1&gt;&lt;h2 id=&quot;一-环境搭建&quot;&gt;&lt;a href=&quot;#一-环境搭建&quot;
      
    
    </summary>
    
    
      <category term="nginx" scheme="http://blog.loveyx815.cn/categories/nginx/"/>
    
    
      <category term="nginx" scheme="http://blog.loveyx815.cn/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Java并发</title>
    <link href="http://blog.loveyx815.cn/2020/04/24/summary/%E5%B9%B6%E5%8F%91/Java%E5%B9%B6%E5%8F%91/"/>
    <id>http://blog.loveyx815.cn/2020/04/24/summary/%E5%B9%B6%E5%8F%91/Java%E5%B9%B6%E5%8F%91/</id>
    <published>2020-04-23T16:00:00.000Z</published>
    <updated>2020-04-28T17:30:30.787Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java并发"><a href="#Java并发" class="headerlink" title="Java并发"></a>Java并发</h1><h2 id="一、基础概念"><a href="#一、基础概念" class="headerlink" title="一、基础概念"></a>一、基础概念</h2><p>线程和进程的区别：</p><blockquote><p> 进程是指处于运行过程中的程序，并且具有一定的独立功能。进程是系统进行资源分配和调度的一个单位。当程序进入内存运行时，即为线程。 </p><p>一个进程可以拥有多个线程组合，线程是组成进程的基本单位。</p></blockquote><ol><li><p>线程状态</p><ul><li>New(新创建)</li><li>Runnable（可运行）</li><li>Blocked(被阻塞)</li><li>Waiting(等待)</li><li>Time waiting(计时等待)</li><li>Terminated(被终止)</li></ul><p>下面介绍线程状态的含义：</p><ul><li><strong>新创建线程</strong></li></ul><blockquote><p>用new创建个新线程时，他还未开始运行，表示这还处于新创建的状态。</p></blockquote><ul><li>可运行线程</li></ul><blockquote><p>一旦调用start方法，线程处于runnable状态。一个可运行的线程可能正在运行也可能没有运行。</p></blockquote><ul><li>被阻塞线程和等待线程</li></ul><blockquote><p>当线程处于被等待或者阻塞状态时，暂时不活动，他不运行任何代码，并且只会消耗最小的资源，直到线程调度器重新激活它。</p></blockquote><ul><li>被终止的线程</li></ul><blockquote><p>线程因为run方法执行完毕而自然死亡、因为一个未捕获的异常终止了run方法而意外死亡</p></blockquote><p>线程运行状态图<br><img src="D:%5C%E4%BB%A3%E7%A0%81%E4%B9%8B%E9%81%93%5C%E7%BB%98%E5%9B%BE%5CJava%E7%BA%BF%E7%A8%8B%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81.png" alt="Java线程运行状态"></p></li><li><p>线程属性</p><ul><li>优先级</li></ul><p>默认情况下，一个线程继承他父线程的优先级。每当线程调度器有机会选择新线程时，他首先选择具有较高优先级的线程。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置线程的优先级，大小一般1-10</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setPriority</span><span class="params">(<span class="keyword">int</span> newPriority)</span></span></span><br><span class="line"><span class="function"><span class="comment">//当前线程处于让步状态，会调度其他优先级&gt;=当前优先级的线程</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">yield</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><ul><li>守护线程</li></ul><p><code>void setDaemon(boolean isDaemon)</code>通过该方法转换成守护线程，守护线程必须在线程启动之前调用。用途就是为其他线程提供服务，当只有守护线程的时候JVM就直接退出了。</p></li><li><p>同步</p></li></ol><ul><li>锁</li></ul><p><strong>ReentrantLock:</strong></p><p>用可重入锁保护代码块</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Lock mylock = <span class="keyword">new</span>  ReentrantLock();</span><br><span class="line">mylock.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span>&#123;</span><br><span class="line">    <span class="comment">//保证资源一定会解锁</span></span><br><span class="line">    mylock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>条件对象：</strong></p><p>需要线程安全区域可能还需要一定的条件支持。若一个线程在获得锁之后，一直在等待条件满足才能完成自己的线程，而使条件发生改变的线程正在等待获得锁。那么此时就就产生死锁。</p><p>也就是两个线程互相依赖对方资源。</p><p><strong>解决方案：</strong></p><p>先来了解下<strong>Condition</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Condition <span class="title">newCondition</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//返回一个与该锁相关的条件对象</span></span></span><br><span class="line"><span class="function"><span class="comment">//对条件对象的操作</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">await</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//将该线程放到条件的等待集合中</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">signalAll</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//解除该条件的等待集合中的所有线程的阻塞状态</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">signal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//从该条件的等待集合中随机选择一个线程，解除其阻塞状态</span></span></span><br></pre></td></tr></table></figure><p><strong>Synchronized</strong></p><p>锁和条件：</p><ul><li><p>锁用来保护代码片段，任何时刻只能有一个线程执行被保护的代码</p></li><li><p>锁可以管理视图进入被保护代码段的线程</p></li><li><p>锁可以拥有一个或多个相关条件对象</p></li><li><p>每个条件对象管理那些已经进入被保护的代码段但还不能运行的线程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以下如果当前对象没有获得该锁，会抛出异常</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">notifyAll</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//解除那些在改对象上调用wait方法的线程的阻塞状态。该方法只能在同步方法或同步代码块中调用。</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">notify</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//与上面的不同的是，这个这能随机选择一个线程解除其阻塞状态</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wait</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//让该线程进入等待状态直到他被通知</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wait</span><span class="params">(<span class="keyword">long</span> millis)</span></span></span><br><span class="line"><span class="function"><span class="comment">//指定等待多少毫秒</span></span></span><br></pre></td></tr></table></figure></li></ul><p><strong>Volatile：</strong></p><blockquote><p>volatile关键字为实例域的同步访问提供了一共免锁机制。如果声明一个域为volatile，编译器和JVM就知道该域是可能被另一个线程并发更新的。对volatile域变量更新是所有线程共享的域，还可以防止指令重排。</p></blockquote><p>Volatile变量不能提供原子性，在语句执行的过程中不能保证读取、写入不被中断，不能确保线程安全。</p><p><strong>final：</strong></p><p>除了volatile和锁之外能安全的读取一个域，final关键字修饰的域也可以。</p><p><strong>读写锁</strong></p><blockquote><p><strong>ReentrantReadWriteLock</strong>适合读多写少的并发</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//得到一个可以被多个读操作公用的读锁，会排斥所有的写操作</span></span><br><span class="line"><span class="function">Lock <span class="title">readLock</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">//得到一个写锁，排斥所有的读、写操作</span></span></span><br><span class="line"><span class="function">Lock <span class="title">writeLock</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><p>如何使用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//新建个读写锁对象</span></span><br><span class="line">         ReentrantReadWriteLock reentrantReadWriteLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line">         <span class="comment">//获取读锁</span></span><br><span class="line">        Lock readLock = reentrantReadWriteLock.readLock();</span><br><span class="line">        <span class="comment">//获取写锁</span></span><br><span class="line">        Lock writeLock = reentrantReadWriteLock.writeLock();</span><br><span class="line"></span><br><span class="line"><span class="comment">//读操作</span></span><br><span class="line">readLock.lock();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        readLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//写操作</span></span><br><span class="line">writeLock.lock();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        writeLock.unlock();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>-</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Java并发&quot;&gt;&lt;a href=&quot;#Java并发&quot; class=&quot;headerlink&quot; title=&quot;Java并发&quot;&gt;&lt;/a&gt;Java并发&lt;/h1&gt;&lt;h2 id=&quot;一、基础概念&quot;&gt;&lt;a href=&quot;#一、基础概念&quot; class=&quot;headerlink&quot; titl
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="JUC" scheme="http://blog.loveyx815.cn/tags/JUC/"/>
    
      <category term="并发" scheme="http://blog.loveyx815.cn/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis在SpringBoot中的相关配置</title>
    <link href="http://blog.loveyx815.cn/2020/04/21/summary/Mybatis%E5%9C%A8SpringBoot%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/"/>
    <id>http://blog.loveyx815.cn/2020/04/21/summary/Mybatis%E5%9C%A8SpringBoot%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/</id>
    <published>2020-04-20T16:00:00.000Z</published>
    <updated>2020-04-21T13:35:02.811Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Mybatis在SpringBoot中的相关配置"><a href="#Mybatis在SpringBoot中的相关配置" class="headerlink" title="Mybatis在SpringBoot中的相关配置"></a>Mybatis在SpringBoot中的相关配置</h1><p>在DAO层采取一些配置化、插件的方式去开发，通过mybatis配置xml去引入</p><ul><li><p>新建一个<strong>mybatis-config.xml</strong>文件，放入resource文件夹下面</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Globally enables or disables any caches configured in any mapper under this configuration --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Sets the number of seconds the driver will wait for a response from the database --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultStatementTimeout"</span> <span class="attr">value</span>=<span class="string">"3000"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Enables automatic mapping from classic database column names A_COLUMN to camel case classic Java property names aColumn --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--驼峰命名设置，会把从数据库里查出的A_COLUMN，转换成aColumn--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Allows JDBC support for generated keys. A compatible driver is required.</span></span><br><span class="line"><span class="comment">        This setting forces generated keys to be used if set to true,</span></span><br><span class="line"><span class="comment">         as some drivers deny compatibility but still work --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置控制台打印sql --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;setting name="logImpl" value="stdout_logging" /&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Continue going here --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--&lt;typeAliases&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;package name="cn.com.countrygarden.ucenter.entity"/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;/typeAliases&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- com.github.pagehelper为PageHelper类所在包名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.github.pagehelper.PageHelper"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 4.0.0以后版本可以不设置该参数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span> <span class="attr">value</span>=<span class="string">"mysql"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 该参数默认为false --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置为true时，会将RowBounds第一个参数offset当成pageNum页码使用 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 和startPage中的pageNum效果一样--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"offsetAsPageNum"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 该参数默认为false --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置为true时，使用RowBounds分页会进行count查询 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"rowBoundsWithCount"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置为true时，如果pageSize=0或者RowBounds.limit = 0就会查询出全部的结果 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- （相当于没有执行分页查询，但是返回结果仍然是Page类型）--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pageSizeZero"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 3.3.0版本可用 - 分页参数合理化，默认false禁用 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 启用合理化时，如果pageNum&lt;1会查询第一页，如果pageNum&gt;pages会查询最后一页 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 禁用合理化时，如果pageNum&lt;1或pageNum&gt;pages会返回空数据 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"reasonable"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 3.5.0版本可用 - 为了支持startPage(Object params)方法 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 增加了一个`params`参数来配置参数映射，用于从Map或ServletRequest中取值 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 可以配置pageNum,pageSize,count,pageSizeZero,reasonable,orderBy,不配置映射的用默认值 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 不理解该含义的前提下，不要随便复制该配置 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;property name="params" value="pageNum=pageHelperStart;pageSize=pageHelperRows;"/&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 支持通过Mapper接口参数来传递分页参数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"supportMethodsArguments"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- always总是返回PageInfo类型,check检查返回类型是否为PageInfo,none返回Page --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"returnPageInfo"</span> <span class="attr">value</span>=<span class="string">"none"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--&lt;mappers&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&amp;lt;!&amp;ndash;&lt;package name="cn.com.countrygarden.ucenter.mapper" /&gt;&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="mappers/DiaryMapper.xml"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="mappers/EmpEvaluateMapper.xml"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="mappers/EmployeeMapper.xml"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="mappers/LikesMapper.xml"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="mappers/PicMapper.xml"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="mappers/RepliesMapper.xml"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="mappers/TeamMapper.xml"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="mappers/UserMapper.xml"/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;/mappers&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在application.properties中设置引用该配置文件</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mybatis.config-location</span>=<span class="string">classpath:mybatis-config.xml</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Mybatis在SpringBoot中的相关配置&quot;&gt;&lt;a href=&quot;#Mybatis在SpringBoot中的相关配置&quot; class=&quot;headerlink&quot; title=&quot;Mybatis在SpringBoot中的相关配置&quot;&gt;&lt;/a&gt;Mybatis在Spring
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="框架系列" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/%E6%A1%86%E6%9E%B6%E7%B3%BB%E5%88%97/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="SpringBoot" scheme="http://blog.loveyx815.cn/tags/SpringBoot/"/>
    
      <category term="Mybatis" scheme="http://blog.loveyx815.cn/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>设计模式-工厂模式</title>
    <link href="http://blog.loveyx815.cn/2020/04/21/summary/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    <id>http://blog.loveyx815.cn/2020/04/21/summary/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</id>
    <published>2020-04-20T16:00:00.000Z</published>
    <updated>2020-04-23T06:43:49.803Z</updated>
    
    <content type="html"><![CDATA[<h1 id="设计模式-工厂模式"><a href="#设计模式-工厂模式" class="headerlink" title="设计模式-工厂模式"></a>设计模式-工厂模式</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;设计模式-工厂模式&quot;&gt;&lt;a href=&quot;#设计模式-工厂模式&quot; class=&quot;headerlink&quot; title=&quot;设计模式-工厂模式&quot;&gt;&lt;/a&gt;设计模式-工厂模式&lt;/h1&gt;
      
    
    </summary>
    
    
      <category term="设计模式" scheme="http://blog.loveyx815.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="http://blog.loveyx815.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Java泛型设计</title>
    <link href="http://blog.loveyx815.cn/2020/04/21/summary/Java%E6%B3%9B%E5%9E%8B%E8%AE%BE%E8%AE%A1/"/>
    <id>http://blog.loveyx815.cn/2020/04/21/summary/Java%E6%B3%9B%E5%9E%8B%E8%AE%BE%E8%AE%A1/</id>
    <published>2020-04-20T16:00:00.000Z</published>
    <updated>2020-04-23T10:53:20.447Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java泛型设计"><a href="#Java泛型设计" class="headerlink" title="Java泛型设计"></a>Java泛型设计</h1><ul><li><p>为什么要去设计泛型？</p><blockquote><p>为了可以编写被很多不同类型对象所重用的代码</p></blockquote></li><li><p>泛型是如何定义？</p><h2 id="1-泛型类：-class-ClassName"><a href="#1-泛型类：-class-ClassName" class="headerlink" title="1. 泛型类： class ClassName"></a>1. 泛型类： class ClassName<T></h2><p>T是一个类型变量，可以是任意的类型，也可以有多个类型比变量。</p><blockquote><p>类型变量使用大写形式，使用<strong>E</strong>表示集合的元素类型，<strong>K</strong>和<strong>V</strong>分别表示关键字和值得类型，是一个Map关系。T（需要时还可以用临近的字母U和S）表示任意类型</p></blockquote><h2 id="2-泛型方法：-T-function-T-a"><a href="#2-泛型方法：-T-function-T-a" class="headerlink" title="2. 泛型方法：  T  function(T a)"></a>2. 泛型方法： <T> T  function(T a)</h2><p>类型变量放在修饰符的后面，返回类型的前面</p><blockquote><p>若方法的类型参数是个可变的参数<strong>T…a</strong>,若传入的参数类型不统一就会抛出异常</p></blockquote><h2 id="3-类型变量的限定"><a href="#3-类型变量的限定" class="headerlink" title="3. 类型变量的限定"></a>3. 类型变量的限定</h2><p>如果要实现个泛型的比较方法，得调用compareTo方法比较，而使用该方法得对象要实现<strong>Compareable</strong>接口。此时需要在泛型方法中增加一个限定项，只允许传入实现了<strong>Compareable</strong>接口的类。</p><p>修改后限定泛型的方法签名：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;T extends Compareable&gt; <span class="function">T  <span class="title">function</span><span class="params">(T a)</span></span></span><br></pre></td></tr></table></figure><p>通用的写法是 <T extends BoundingType>，表示T是绑定类型的子类型，绑定类型可以是接口或者类。绑定类型也可以是多个类型，用<strong>&amp;</strong>分隔 </p><h2 id="4-约束与局限性"><a href="#4-约束与局限性" class="headerlink" title="4. 约束与局限性"></a>4. 约束与局限性</h2></li></ul><ul><li><p>不能用基本类型实例化类型参数</p><p>不能用基本类型参数去代替基本类型。因为泛型使用过程会有类型擦除。擦除后就变成<code>Object</code>类型，而基本类型又不能存储到<strong>Object</strong>中。可以使用包装类型。</p></li><li><p>判断对象是否属于定义的泛型类型</p><p>现有泛型类 <code>Pair&lt;T&gt;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pari</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>判断对象a是否是该泛型类任一类型：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a <span class="keyword">instanceof</span> Pair&lt;String&gt;) <span class="comment">//error</span></span><br><span class="line"><span class="keyword">if</span> (a <span class="keyword">instanceof</span> Pair&lt;T&gt;) <span class="comment">//error</span></span><br><span class="line">Pair&lt;String&gt; p = (Pair&lt;String&gt;)a <span class="comment">//error</span></span><br><span class="line"><span class="comment">//正确的操作是判断对象的Class类型</span></span><br><span class="line">a.getClass()<span class="comment">//返回的就是Pair.class</span></span><br></pre></td></tr></table></figure><p>同时也不能创建参数化类型的数组</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不能实例化参数化类型的数组</span></span><br><span class="line">Pair&lt;String&gt;[] table = <span class="keyword">new</span> Pair&lt;String&gt;[<span class="number">10</span>];<span class="comment">//error</span></span><br></pre></td></tr></table></figure><p>在类型擦除的时候，table的类型是Pair[]，就算用Object[]来接收，table还是会记住他的原始类型Pari[]，如果将其他对象放入table中，还是会有类型错误</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object[] table = <span class="keyword">new</span> Pair&lt;String&gt;[<span class="number">10</span>];</span><br><span class="line">table[<span class="number">0</span>]=<span class="string">"string"</span>;<span class="comment">//error</span></span><br></pre></td></tr></table></figure></li><li><p>不能实例化类型变量</p><p>不能使用像new T( ),new T[ ],T.class这样的表达式中的类型变量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造器错误</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    first = <span class="keyword">new</span> T();</span><br><span class="line">    second = <span class="keyword">new</span> T();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>正确的是提供个构造器表达式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Pair&lt;String&gt; p = Pair.makePair(String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//makePair构造器调用，通过反射 newInstance()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Pair&lt;T&gt; <span class="title">makePair</span><span class="params">(Class&lt;T&gt; cl)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;&gt;(cl.newInstance(),cl.newInstance())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Java泛型设计&quot;&gt;&lt;a href=&quot;#Java泛型设计&quot; class=&quot;headerlink&quot; title=&quot;Java泛型设计&quot;&gt;&lt;/a&gt;Java泛型设计&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;为什么要去设计泛型？&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;为了可以编写
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>summary/Git命令大全</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/summary/Git%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/summary/Git%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/</id>
    <published>2020-04-19T07:42:49.025Z</published>
    <updated>2020-02-04T08:15:00.379Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Git命令大全"><a href="#Git命令大全" class="headerlink" title="Git命令大全"></a>Git命令大全</h1><h2 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a>git config</h2><p>配置 Git 的相关参数。</p><p>Git 一共有3个配置文件：</p><p>\1. 仓库级的配置文件：在仓库的 <code>.git/.gitconfig</code>，该配置文件只对所在的仓库有效。<br> \2. 全局配置文件：Mac 系统在 <code>~/.gitconfig</code>，Windows 系统在 <code>C:\Users\&lt;用户名&gt;\.gitconfig</code>。<br> \3. 系统级的配置文件：在 Git 的安装目录下（Mac 系统下安装目录在 <code>/usr/local/git</code>）的 <code>etc</code> 文件夹中的 <code>gitconfig</code>。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看配置信息</span></span><br><span class="line"><span class="comment"># --local：仓库级，--global：全局级，--system：系统级</span></span><br><span class="line">$ git config &lt;--local <span class="params">| --global |</span> --system&gt; -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前生效的配置信息</span></span><br><span class="line">$ git config -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑配置文件</span></span><br><span class="line"><span class="comment"># --local：仓库级，--global：全局级，--system：系统级</span></span><br><span class="line">$ git config &lt;--local <span class="params">| --global |</span> --system&gt; -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加配置项</span></span><br><span class="line"><span class="comment"># --local：仓库级，--global：全局级，--system：系统级</span></span><br><span class="line">$ git config &lt;--local <span class="params">| --global |</span> --system&gt; --add &lt;name&gt; &lt;value&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取配置项</span></span><br><span class="line">$ git config &lt;--local <span class="params">| --global |</span> --system&gt; --get &lt;name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除配置项</span></span><br><span class="line">$ git config &lt;--local <span class="params">| --global |</span> --system&gt; --unset &lt;name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置提交记录中的用户信息</span></span><br><span class="line">$ git config --global user.name &lt;用户名&gt;</span><br><span class="line">$ git config --global user.email &lt;邮箱地址&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改Git缓存区的大小</span></span><br><span class="line"><span class="comment"># 如果提交的内容较大，默认缓存较小，提交会失败</span></span><br><span class="line"><span class="comment"># 缓存大小单位：B，例如：524288000（500MB）</span></span><br><span class="line">$ git config --global http.postBuffer &lt;缓存大小&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 git status/git diff 命令时以高亮或彩色方式显示改动状态</span></span><br><span class="line">$ git config --global color.ui <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置可以缓存密码，默认缓存时间15分钟</span></span><br><span class="line">$ git config --global credential.helper cache</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置密码的缓存时间</span></span><br><span class="line"><span class="comment"># 缓存时间单位：秒</span></span><br><span class="line">$ git config --global credential.helper <span class="string">'cache --timeout=&lt;缓存时间&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置长期存储密码</span></span><br><span class="line">$ git config --global credential.helper store</span><br></pre></td></tr></table></figure><h2 id="git-clone"><a href="#git-clone" class="headerlink" title="git clone"></a>git clone</h2><p>从远程仓库克隆一个版本库到本地。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认在当前目录下创建和版本库名相同的文件夹并下载版本到该文件夹下</span></span><br><span class="line">$ git <span class="built_in">clone</span> &lt;远程仓库的网址&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定本地仓库的目录</span></span><br><span class="line">$ git <span class="built_in">clone</span> &lt;远程仓库的网址&gt; &lt;本地目录&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># -b 指定要克隆的分支，默认是master分支</span></span><br><span class="line">$ git <span class="built_in">clone</span> &lt;远程仓库的网址&gt; -b &lt;分支名称&gt; &lt;本地目录&gt;</span><br></pre></td></tr></table></figure><h2 id="git-init"><a href="#git-init" class="headerlink" title="git init"></a>git init</h2><p>初始化项目所在目录，初始化后会在当前目录下出现一个名为 .git 的目录。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化本地仓库，在当前目录下生成 .git 文件夹</span></span><br><span class="line">$ git init</span><br></pre></td></tr></table></figure><h2 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h2><p>查看本地仓库的状态。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看本地仓库的状态</span></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以简短模式查看本地仓库的状态</span></span><br><span class="line"><span class="comment"># 会显示两列，第一列是文件的状态，第二列是对应的文件</span></span><br><span class="line"><span class="comment"># 文件状态：A 新增，M 修改，D 删除，?? 未添加到Git中</span></span><br><span class="line">$ git status -s</span><br></pre></td></tr></table></figure><h2 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a>git remote</h2><p>操作远程库。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出已经存在的远程仓库</span></span><br><span class="line">$ git remote</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出远程仓库的详细信息，在别名后面列出URL地址</span></span><br><span class="line">$ git remote -v</span><br><span class="line">$ git remote --verbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加远程仓库</span></span><br><span class="line">$ git remote add &lt;远程仓库的别名&gt; &lt;远程仓库的URL地址&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改远程仓库的别名</span></span><br><span class="line">$ git remote rename &lt;原远程仓库的别名&gt; &lt;新的别名&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定名称的远程仓库</span></span><br><span class="line">$ git remote remove &lt;远程仓库的别名&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改远程仓库的 URL 地址</span></span><br><span class="line">$ git remote set-url &lt;远程仓库的别名&gt; &lt;新的远程仓库URL地址&gt;</span><br></pre></td></tr></table></figure><h2 id="git-branch"><a href="#git-branch" class="headerlink" title="git branch"></a>git branch</h2><p>操作 Git 的分支命令。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出本地的所有分支，当前所在分支以 "*" 标出</span></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出本地的所有分支并显示最后一次提交，当前所在分支以 "*" 标出</span></span><br><span class="line">$ git branch -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建新分支，新的分支基于上一次提交建立</span></span><br><span class="line">$ git branch &lt;分支名&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改分支名称</span></span><br><span class="line"><span class="comment"># 如果不指定原分支名称则为当前所在分支</span></span><br><span class="line">$ git branch -m [&lt;原分支名称&gt;] &lt;新的分支名称&gt;</span><br><span class="line"><span class="comment"># 强制修改分支名称</span></span><br><span class="line">$ git branch -M [&lt;原分支名称&gt;] &lt;新的分支名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定的本地分支</span></span><br><span class="line">$ git branch -d &lt;分支名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制删除指定的本地分支</span></span><br><span class="line">$ git branch -D &lt;分支名称&gt;</span><br></pre></td></tr></table></figure><h2 id="git-checkout"><a href="#git-checkout" class="headerlink" title="git checkout"></a>git checkout</h2><p>检出命令，用于创建、切换分支等。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到已存在的指定分支</span></span><br><span class="line">$ git checkout &lt;分支名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并切换到指定的分支，保留所有的提交记录</span></span><br><span class="line"><span class="comment"># 等同于 "git branch" 和 "git checkout" 两个命令合并</span></span><br><span class="line">$ git checkout -b &lt;分支名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并切换到指定的分支，删除所有的提交记录</span></span><br><span class="line">$ git checkout --orphan &lt;分支名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换掉本地的改动，新增的文件和已经添加到暂存区的内容不受影响</span></span><br><span class="line">$ git checkout &lt;文件路径&gt;</span><br></pre></td></tr></table></figure><h2 id="git-cherry-pick"><a href="#git-cherry-pick" class="headerlink" title="git cherry-pick"></a>git cherry-pick</h2><p>把已经提交的记录合并到当前分支。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把已经提交的记录合并到当前分支</span></span><br><span class="line">$ git cherry-pick &lt;commit ID&gt;</span><br></pre></td></tr></table></figure><h2 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h2><p>把要提交的文件的信息添加到暂存区中。当使用 git commit 时，将依据暂存区中的内容来进行文件的提交。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 把指定的文件添加到暂存区中</span></span><br><span class="line">$ git <span class="keyword">add</span> &lt;文件路径&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta"># 添加所有修改、已删除的文件到暂存区中</span></span><br><span class="line">$ git <span class="keyword">add</span> -u [&lt;文件路径&gt;]</span><br><span class="line">$ git <span class="keyword">add</span> --update [&lt;文件路径&gt;]</span><br><span class="line"></span><br><span class="line"><span class="meta"># 添加所有修改、已删除、新增的文件到暂存区中，省略 &lt;文件路径&gt; 即为当前目录</span></span><br><span class="line">$ git <span class="keyword">add</span> -A [&lt;文件路径&gt;]</span><br><span class="line">$ git <span class="keyword">add</span> --all [&lt;文件路径&gt;]</span><br><span class="line"></span><br><span class="line"><span class="meta"># 查看所有修改、已删除但没有提交的文件，进入一个子命令系统</span></span><br><span class="line">$ git <span class="keyword">add</span> -i [&lt;文件路径&gt;]</span><br><span class="line">$ git <span class="keyword">add</span> --interactive [&lt;文件路径&gt;]</span><br></pre></td></tr></table></figure><h2 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h2><p>将暂存区中的文件提交到本地仓库中。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把暂存区中的文件提交到本地仓库，调用文本编辑器输入该次提交的描述信息</span></span><br><span class="line">$ git commit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把暂存区中的文件提交到本地仓库中并添加描述信息</span></span><br><span class="line">$ git commit -m <span class="string">"&lt;提交的描述信息&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把所有修改、已删除的文件提交到本地仓库中</span></span><br><span class="line"><span class="comment"># 不包括未被版本库跟踪的文件，等同于先调用了 "git add -u"</span></span><br><span class="line">$ git commit -a -m <span class="string">"&lt;提交的描述信息&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改上次提交的描述信息</span></span><br><span class="line">$ git commit --amend</span><br></pre></td></tr></table></figure><h2 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a>git fetch</h2><p>从远程仓库获取最新的版本到本地的 tmp 分支上。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将远程仓库所有分支的最新版本全部取回到本地</span></span><br><span class="line">$ git fetch &lt;远程仓库的别名&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将远程仓库指定分支的最新版本取回到本地</span></span><br><span class="line">$ git fetch &lt;远程主机名&gt; &lt;分支名&gt;</span><br></pre></td></tr></table></figure><h2 id="git-merge"><a href="#git-merge" class="headerlink" title="git merge"></a>git merge</h2><p>合并分支。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把指定的分支合并到当前所在的分支下</span></span><br><span class="line">$ git merge &lt;分支名称&gt;</span><br></pre></td></tr></table></figure><h2 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h2><p>比较版本之间的差异。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 比较当前文件和暂存区中文件的差异，显示没有暂存起来的更改</span></span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较暂存区中的文件和上次提交时的差异</span></span><br><span class="line">$ git diff --cached</span><br><span class="line">$ git diff --staged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较当前文件和上次提交时的差异</span></span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看从指定的版本之后改动的内容</span></span><br><span class="line">$ git diff &lt;commit ID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较两个分支之间的差异</span></span><br><span class="line">$ git diff &lt;分支名称&gt; &lt;分支名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看两个分支分开后各自的改动内容</span></span><br><span class="line">$ git diff &lt;分支名称&gt;...&lt;分支名称&gt;</span><br></pre></td></tr></table></figure><h2 id="git-pull"><a href="#git-pull" class="headerlink" title="git pull"></a>git pull</h2><p>从远程仓库获取最新版本并合并到本地。<br> 首先会执行 <code>git fetch</code>，然后执行 <code>git merge</code>，把获取的分支的 HEAD 合并到当前分支。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从远程仓库获取最新版本。</span></span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure><h2 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h2><p>把本地仓库的提交推送到远程仓库。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把本地仓库的分支推送到远程仓库的指定分支</span></span><br><span class="line">$ git push &lt;远程仓库的别名&gt; &lt;本地分支名&gt;<span class="symbol">:&lt;</span>远程分支名&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定的远程仓库的分支</span></span><br><span class="line">$ git push &lt;远程仓库的别名&gt; <span class="symbol">:&lt;</span>远程分支名&gt;</span><br><span class="line">$ git push &lt;远程仓库的别名&gt; --delete &lt;远程分支名&gt;</span><br></pre></td></tr></table></figure><h2 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h2><p>显示提交的记录。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印所有的提交记录</span></span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印从第一次提交到指定的提交的记录</span></span><br><span class="line">$ git <span class="built_in">log</span> &lt;commit ID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印指定数量的最新提交的记录</span></span><br><span class="line">$ git <span class="built_in">log</span> -&lt;指定的数量&gt;</span><br></pre></td></tr></table></figure><h2 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h2><p>还原提交记录。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重置暂存区，但文件不受影响</span></span><br><span class="line"><span class="comment"># 相当于将用 "git add" 命令更新到暂存区的内容撤出暂存区，可以指定文件</span></span><br><span class="line"><span class="comment"># 没有指定 commit ID 则默认为当前 HEAD</span></span><br><span class="line">$ git reset [&lt;文件路径&gt;]</span><br><span class="line">$ git reset --mixed [&lt;文件路径&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 HEAD 的指向改变，撤销到指定的提交记录，文件未修改</span></span><br><span class="line">$ git reset &lt;commit ID&gt;</span><br><span class="line">$ git reset --mixed &lt;commit ID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 HEAD 的指向改变，撤销到指定的提交记录，文件未修改</span></span><br><span class="line"><span class="comment"># 相当于调用 "git reset --mixed" 命令后又做了一次 "git add"</span></span><br><span class="line">$ git reset --soft &lt;commit ID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 HEAD 的指向改变，撤销到指定的提交记录，文件也修改了</span></span><br><span class="line">$ git reset --hard &lt;commit ID&gt;</span><br></pre></td></tr></table></figure><h2 id="git-revert"><a href="#git-revert" class="headerlink" title="git revert"></a>git revert</h2><p>生成一个新的提交来撤销某次提交，此次提交之前的所有提交都会被保留。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个新的提交来撤销某次提交</span></span><br><span class="line">$ git revert &lt;commit ID&gt;</span><br></pre></td></tr></table></figure><h2 id="git-tag"><a href="#git-tag" class="headerlink" title="git tag"></a>git tag</h2><p>操作标签的命令。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印所有的标签</span></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加轻量标签，指向提交对象的引用，可以指定之前的提交记录</span></span><br><span class="line">$ git tag &lt;标签名称&gt; [&lt;commit ID&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加带有描述信息的附注标签，可以指定之前的提交记录</span></span><br><span class="line">$ git tag -a &lt;标签名称&gt; -m &lt;标签描述信息&gt; [&lt;commit ID&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到指定的标签</span></span><br><span class="line">$ git checkout &lt;标签名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看标签的信息</span></span><br><span class="line">$ git show &lt;标签名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定的标签</span></span><br><span class="line">$ git tag -d &lt;标签名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将指定的标签提交到远程仓库</span></span><br><span class="line">$ git push &lt;远程仓库的别名&gt; &lt;标签名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将本地所有的标签全部提交到远程仓库</span></span><br><span class="line">$ git push &lt;远程仓库的别名&gt; –tags</span><br></pre></td></tr></table></figure><h2 id="git-mv"><a href="#git-mv" class="headerlink" title="git mv"></a>git mv</h2><p>重命名文件或者文件夹。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重命名指定的文件或者文件夹</span></span><br><span class="line">$ git mv &lt;源文件/文件夹&gt; &lt;目标文件/文件夹&gt;</span><br></pre></td></tr></table></figure><h2 id="git-rm"><a href="#git-rm" class="headerlink" title="git rm"></a>git rm</h2><p>删除文件或者文件夹。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 移除跟踪指定的文件，并从本地仓库的文件夹中删除</span></span><br><span class="line">$ git rm &lt;文件路径&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除跟踪指定的文件夹，并从本地仓库的文件夹中删除</span></span><br><span class="line">$ git rm -r &lt;文件夹路径&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除跟踪指定的文件，在本地仓库的文件夹中保留该文件</span></span><br><span class="line">$ git rm --cached</span><br></pre></td></tr></table></figure><h2 id="Git操作场景示例"><a href="#Git操作场景示例" class="headerlink" title="Git操作场景示例"></a>Git操作场景示例</h2><h3 id="1-删除掉本地不存在的远程分支"><a href="#1-删除掉本地不存在的远程分支" class="headerlink" title="1. 删除掉本地不存在的远程分支"></a>1. 删除掉本地不存在的远程分支</h3><p>多人合作开发时，如果远程的分支被其他开发删除掉，在本地执行 <code>git branch --all</code> 依然会显示该远程分支，可使用下列的命令进行删除：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 pull 命令，添加 -p 参数</span></span><br><span class="line">$ git pull -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等同于下面的命令</span></span><br><span class="line">$ git fetch -p</span><br><span class="line">$ git fetch --prune origin</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Git命令大全&quot;&gt;&lt;a href=&quot;#Git命令大全&quot; class=&quot;headerlink&quot; title=&quot;Git命令大全&quot;&gt;&lt;/a&gt;Git命令大全&lt;/h1&gt;&lt;h2 id=&quot;git-config&quot;&gt;&lt;a href=&quot;#git-config&quot; class=&quot;head
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Docker从入坑到放弃</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/Docker%E4%BB%8E%E5%85%A5%E5%9D%91%E5%88%B0%E6%94%BE%E5%BC%83/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/Docker%E4%BB%8E%E5%85%A5%E5%9D%91%E5%88%B0%E6%94%BE%E5%BC%83/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T11:09:11.109Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker从入坑到放弃"><a href="#Docker从入坑到放弃" class="headerlink" title="Docker从入坑到放弃"></a>Docker从入坑到放弃</h1><ul><li><h2 id="环境安装问题"><a href="#环境安装问题" class="headerlink" title="环境安装问题"></a>环境安装问题</h2><p>  <strong>windows7安装docker异常</strong> ：looks like something went wrong in step ‘looking for vboxmanage.exe’<br>  <strong>解决方案</strong>：从安装目录的 <code>start.sh</code>脚本开始排查，很大可能是因为电脑的环境变量没有创建成功，所以需要把脚本对应的变量打印出来看看。</p></li></ul><blockquote><p>打印语句：<br>echo “$VBOX_MSI_INSTALL_PATH”<br>#“变量名称”<br>read param</p></blockquote><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20190802185759937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure><pre><code>**异常信息显示是‘looking for vboxmanage.exe’ ，所以 主要在这里排查，完善对应的变量名（这里已经是替换过的全命名路径了）**</code></pre><blockquote><p><strong>保存脚本后，在运行启动快捷方式</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20190802190246533.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure></blockquote><p><strong>运行成功</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Docker从入坑到放弃&quot;&gt;&lt;a href=&quot;#Docker从入坑到放弃&quot; class=&quot;headerlink&quot; title=&quot;Docker从入坑到放弃&quot;&gt;&lt;/a&gt;Docker从入坑到放弃&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;h2 id=&quot;环境安装问题&quot;&gt;&lt;a href=
      
    
    </summary>
    
    
      <category term="Docker" scheme="http://blog.loveyx815.cn/categories/Docker/"/>
    
    
      <category term="Docker" scheme="http://blog.loveyx815.cn/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>maven项目pom.xml报错</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/maven%E9%A1%B9%E7%9B%AEpom.xml%E6%8A%A5%E9%94%99/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/maven%E9%A1%B9%E7%9B%AEpom.xml%E6%8A%A5%E9%94%99/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T11:09:08.835Z</updated>
    
    <content type="html"><![CDATA[<h1 id="maven项目pom-xml报错"><a href="#maven项目pom-xml报错" class="headerlink" title="maven项目pom.xml报错"></a>maven项目pom.xml报错</h1><blockquote><p>expected START_TAG or END_TAG not TEXT (position: TEXT seen …</dependency>\ua0\r\n &lt;d… @60:11) less… (Ctrl+F1)<br>Inspection info: Inspects a Maven model for resolution problems.</p></blockquote><p>  这种就是从别的地方复制粘贴的dependency时候有空格存在，导致文件识别不了，用IDE查找下空格的位置，删除就可以解决</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;maven项目pom-xml报错&quot;&gt;&lt;a href=&quot;#maven项目pom-xml报错&quot; class=&quot;headerlink&quot; title=&quot;maven项目pom.xml报错&quot;&gt;&lt;/a&gt;maven项目pom.xml报错&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;e
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="maven" scheme="http://blog.loveyx815.cn/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>Springboot中Redis学习（事务、Lua、跨域）</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/Springboot%E4%B8%ADRedis%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8B%E5%8A%A1%E3%80%81Lua%E3%80%81%E8%B7%A8%E5%9F%9F%EF%BC%89/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/Springboot%E4%B8%ADRedis%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8B%E5%8A%A1%E3%80%81Lua%E3%80%81%E8%B7%A8%E5%9F%9F%EF%BC%89/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T11:09:04.356Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h2><h2 id="Lua脚本"><a href="#Lua脚本" class="headerlink" title="Lua脚本"></a>Lua脚本</h2><blockquote><p>Lua脚本在Redis中具备原子性，可以保证数据一致性的高并发环境。</p></blockquote><ul><li>Spring中提供了RedisScript接口，DefaultRedisScript为他的实现类<br> <strong>RedisScript接口</strong>：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RedisScript</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"> <span class="comment">//获得脚本的sha1</span></span><br><span class="line"> <span class="function">String <span class="title">getSha1</span><span class="params">()</span></span>;</span><br><span class="line"> <span class="comment">//获取脚本的返回值</span></span><br><span class="line"> <span class="function">Class&lt;T&gt; <span class="title">getResultType</span><span class="params">()</span></span>;</span><br><span class="line"> <span class="comment">//获取脚本的字符串</span></span><br><span class="line"> <span class="function">String <span class="title">getScriptAsString</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><strong>缓存注解应用</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取ID，取参数ID缓存用户</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="meta">@Cacheable</span>(value = <span class="string">" redisCache"</span>,key = <span class="string">"'redis_user_'+#id"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> dao.getUser(id);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p><strong>@Cacheable</strong> 注解会先尝试从指定缓存中取值</p></blockquote>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入用户，mybatis会回填ID，取结果ID缓存用户</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="meta">@Transactional</span></span><br><span class="line">   <span class="meta">@CachePut</span>(value = <span class="string">" redisCache"</span>,key = <span class="string">"'redis_user_'+#result.id"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> User <span class="title">insertUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">       dao.insertUser(user);</span><br><span class="line">       <span class="keyword">return</span> user;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>@CachePut</strong> 注解会把返回的结果放入缓存中<br><strong>注</strong>   <code>AOP基于动态代理，这里同类内部调用方法，不会使注解生效</code></p></blockquote><ul><li><strong>springboot中解决跨域问题</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span>(origins = &#123;<span class="string">"对方的域名"</span>, <span class="string">"null"</span>&#125;)</span><br></pre></td></tr></table></figure><p>将该注解加在对用的controller的类或者方法上就可以完成对跨域的访问<br><a href="https://github.com/rainandsunshine/springboot_reomte.git" target="_blank" rel="noopener">代码Git地址</a><a href="https://github.com/rainandsunshine/springboot_reomte.git" target="_blank" rel="noopener">https://github.com/rainandsunshine/springboot_reomte.git</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Redis事务&quot;&gt;&lt;a href=&quot;#Redis事务&quot; class=&quot;headerlink&quot; title=&quot;Redis事务&quot;&gt;&lt;/a&gt;Redis事务&lt;/h2&gt;&lt;h2 id=&quot;Lua脚本&quot;&gt;&lt;a href=&quot;#Lua脚本&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
    
      <category term="Redis,分布式" scheme="http://blog.loveyx815.cn/categories/Redis-%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="SpringBoot" scheme="http://blog.loveyx815.cn/tags/SpringBoot/"/>
    
      <category term="Redis" scheme="http://blog.loveyx815.cn/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>String、StringBuilder做为实参在方法中修改字符串值的问题</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/String%E3%80%81StringBuilder%E5%81%9A%E4%B8%BA%E5%AE%9E%E5%8F%82%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%AD%E4%BF%AE%E6%94%B9%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%80%BC%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/String%E3%80%81StringBuilder%E5%81%9A%E4%B8%BA%E5%AE%9E%E5%8F%82%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%AD%E4%BF%AE%E6%94%B9%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%80%BC%E7%9A%84%E9%97%AE%E9%A2%98/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T11:09:06.526Z</updated>
    
    <content type="html"><![CDATA[<h1 id="String、StringBuilder做为实参在方法中修改字符串值的问题"><a href="#String、StringBuilder做为实参在方法中修改字符串值的问题" class="headerlink" title="String、StringBuilder做为实参在方法中修改字符串值的问题"></a>String、StringBuilder做为实参在方法中修改字符串值的问题</h1><blockquote><p>场景介绍：需要在一个方法中同时修改两个字符串的值，因为不想传回一个数组，所以就尝试下直接修改字符串对象（地址引用）</p></blockquote><ul><li>下面介绍下几种修改方式：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">changeString</span><span class="params">(String originStr)</span></span>&#123;</span><br><span class="line">     originStr=<span class="keyword">new</span> String(<span class="string">"str1 change"</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> main()&#123;</span><br><span class="line">String str1=<span class="string">"I am str1"</span>;</span><br><span class="line">      changeString(str1);</span><br><span class="line">      System.out.println(str1);<span class="comment">//输出I am str1</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">changeString</span><span class="params">(String originStr)</span></span>&#123;</span><br><span class="line">     originStr=<span class="string">"str2 change"</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> main()&#123;</span><br><span class="line">String str2=<span class="string">"I am str2"</span>;</span><br><span class="line">      changeString(str2);</span><br><span class="line">      System.out.println(str2);<span class="comment">//输出I am str2</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>上面两种方式是直接传一个String对象，第一个是直接让形参指向新的对象，结果是方法内改变的值不是影响到实参；第二个是让形参指向一个字符串常量，结果同第一种是一样的。</p><blockquote><p>因为在Java中，参数传递分为两种。一个是基本类型的值引用，这个就不多说了；还有个就是对象引用，而对象引用实际上是把存储在JVM栈区的对象引用的数据拷贝了一份。所以当你在方法内部将该对象拷贝的引用重新指向新的地址对实参是没有影响的。</p></blockquote><p>这是引用拷贝时的示意图</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20191225234124932.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure><p>接着拷贝后的originStr指向新的对象<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20191225234402297.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure><br>可见str1的引用都没有改变，所以这样是不能改变String对象的。</p><blockquote><p>接下来说所第二种为什么也不行，也就是在方法内部不重新为对象引用指向新的对象地址，而是直接给字符串赋值。先来看看String内部是怎么得构造的。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** The value is used for character storage. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Cache the hash code for the string */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> hash; <span class="comment">// Default to 0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** use serialVersionUID from JDK 1.0.2 for interoperability */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6849794470754667710L</span>;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>String类</strong>是一个被final类，也就是它是不能被继承和更改的。里面用一个char数组维护他的字符，所以我们使用的字符串都是里面的char数组转化而来，而这个char[] value也是被final修饰过的。所以String对象具有不能被修改的属性。如下图：</p></blockquote><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20191225235627939.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure><blockquote><p>即使你在方法内部使用的将一个String对象拷贝引用originStr指向一个字符串常量”new str1”，他也是拷贝引用去指向字符串常量池中某一块地址，所以依旧还是不能影响到实参的字符串对象值。</p></blockquote><ul><li>最后是使用了StringBuilder作为参数，在方法内部修改StringBuilder引用指向内存的数据，实现在方法中直接修改字符串的值。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">changeString</span><span class="params">(StringBuilder originStr)</span></span>&#123;</span><br><span class="line">    originStr.replace(<span class="number">0</span>,originStr.length(),<span class="string">"str1 change"</span>);</span><br><span class="line">&#125;</span><br><span class="line">main()&#123;</span><br><span class="line">StringBuilder sb1=<span class="keyword">new</span> StringBuilder(<span class="string">"I am sb1"</span>);</span><br><span class="line">     changeString(sb1);</span><br><span class="line">     System.out.println(sb1);<span class="comment">//输出str1 change</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;String、StringBuilder做为实参在方法中修改字符串值的问题&quot;&gt;&lt;a href=&quot;#String、StringBuilder做为实参在方法中修改字符串值的问题&quot; class=&quot;headerlink&quot; title=&quot;String、StringBuild
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="源码分析" scheme="http://blog.loveyx815.cn/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
      <category term="字符串" scheme="http://blog.loveyx815.cn/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
  </entry>
  
  <entry>
    <title>设计模式-策略模式</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T11:09:01.642Z</updated>
    
    <content type="html"><![CDATA[<h1 id="设计模式-策略模式"><a href="#设计模式-策略模式" class="headerlink" title="设计模式-策略模式"></a>设计模式-策略模式</h1><ul><li><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2> <strong>策略模式（Strategy）</strong>，定义了一组算法，将每个算法都封装起来，并且使它们之间可以互换，可以针对不同业务选择不同逻辑的执行。</li><li><h3 id="场景应用"><a href="#场景应用" class="headerlink" title="场景应用"></a>场景应用</h3> 有一笔订单需要对它进行流程管理。从订单产生-&gt;订单入库-&gt;配送-&gt;确认订单完成，有这样一个流程。这里有订单入库、配送这两个动作标签，在每个订单产生动作标签的时候，执行的不同的业务处理。这里用简单的分支语句来实现就是： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(action==<span class="string">"订单入库"</span>)</span><br><span class="line">｛</span><br><span class="line"><span class="comment">//执行业务代码</span></span><br><span class="line">｝<span class="keyword">else</span> <span class="keyword">if</span>(action==<span class="string">"配送"</span>)&#123;</span><br><span class="line"><span class="comment">//执行业务代码</span></span><br><span class="line">&#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure> 如果这里的分支有很多层，那么这块代码复杂度就会很高，而且也不容易维护。<br> 下面使用<strong>策略模式</strong>实现。</li><li><h2 id="策略模式实现"><a href="#策略模式实现" class="headerlink" title="策略模式实现"></a>策略模式实现</h2></li></ul><p> <strong>1.</strong> 抽象出业务处理器，可以当做分支结构中选择器。这个只是抽象出来的模型，后面需要给他具体实现。<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span>  <span class="class"><span class="keyword">class</span> <span class="title">InspectionSolver</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 业务代码抽象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(Long orderId, Long userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 策略标识，决定执行哪一个策略</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String[] supports();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>2.</strong> 根据抽象模型定义出自己的业务处理器，这就是实际的业务代码，当系统确定你要执行的业务后，就会执行相应的业务代码进行处理。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继承抽象业务处理器并实现自己的业务处理，</span></span><br><span class="line"><span class="comment">//可以根据supports中拥有的动作绑定相应的业务代码</span></span><br><span class="line"><span class="comment">//订单批量转仓</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChangeWarehouseSolver</span> <span class="keyword">extends</span> <span class="title">InspectionSolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(Long orderId, Long userId)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"订单"</span>+orderId+<span class="string">"开始进行批量转仓了。。"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] supports() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[] &#123;InspectionConstant.INSPECTION_TASK_TYPE_BATCH_CHANGE_WAREHOUSE&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//订单转换快递</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChangeShippingSolver</span> <span class="keyword">extends</span> <span class="title">InspectionSolver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(Long orderId, Long userId)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"订单"</span>+orderId+<span class="string">"开始进行转快递了。。"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] supports() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[] &#123;InspectionConstant.INSPECTION_TASK_TYPE_BATCH_CHANGE_SHIPPING&#125;;    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.</strong> 现在策略是有了，所以还需要个调用的过程。想要根据不同的策略执行不同的逻辑业务，需要运用AOP切面得到当前所有具体的策略实现类。然后将对应的supports字段和对应的策略实现类存放在一个Map中。通过Map中的Key-Value就能知道对应的动作的策略，从而实现一个动态处理逻辑的过程。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InspectionSolverChooser</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, InspectionSolver&gt; chooseMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行PostConstruct..."</span>);</span><br><span class="line">        Map&lt;String, InspectionSolver&gt; solverMap = context.getBeansOfType(InspectionSolver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">for</span> (InspectionSolver solver : solverMap.values()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String support : solver.supports()) &#123;</span><br><span class="line">                chooseMap.put(support,solver);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> InspectionSolver <span class="title">choose</span><span class="params">(String type)</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> chooseMap.get(type);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.context=applicationContext;</span><br><span class="line">        System.out.println(<span class="string">"applicationc初始化。。。"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里通过实现ApplicationContextAware这个上下文接口，可以获取所有在Spring中托管的bean。前面的 <strong><em>ChangeWarehouseSolver</em></strong>  和 <strong><em>ChangeShippingSolver</em></strong> 两个策略实现类使用@Component注解过，让他们在Spring容器中注册过bean，<strong>solverMap</strong> 这个Map是用在存放获取Spring容器中的<strong>InspectionSolver</strong> bean，<strong>chooseMap</strong> 这个Map用来存放策略对应的业务。再通过<strong><em>choose(type)</em></strong> 这个方法调用，得到不同动作类型的策略，实现业务处理。</p></blockquote><ul><li>==@PostConstruct==<br>这里在说下@PostConstruct这个注解。当一个类中construct构造方法、@Autowired、@PostConstruct的执行优先级是construct&gt;Autowired&gt;PostConstruct。所以当我们想要使用@Autowired注入的bean的时候，使用构造函数肯定获取不到bean，那么可以把相应的操作放到@PostConstruct这个注解下使用。</li></ul><p><strong>4.</strong> 策略模式使用<br><em>编写测试类</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span></span>= Application<span class="class">.<span class="keyword">class</span>)// 指定<span class="title">spring</span>-<span class="title">boot</span>的启动类</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">InspectionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InspectionSolverChooser chooser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//准备执行动作 转入仓库</span></span><br><span class="line">        String taskType = InspectionConstant.INSPECTION_TASK_TYPE_BATCH_CHANGE_WAREHOUSE;</span><br><span class="line">        Long orderId = <span class="number">12345L</span>;</span><br><span class="line">        Long userId = <span class="number">123L</span>;</span><br><span class="line">        <span class="comment">//获取任务类型对应的solver</span></span><br><span class="line">        InspectionSolver solver = chooser.choose(taskType);</span><br><span class="line">        <span class="keyword">if</span> (solver == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"任务类型暂时无法处理!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//调用不同solver的方法进行处理</span></span><br><span class="line">        solver.solve(orderId,userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>系统枚举类</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> InspectionConstant &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String INSPECTION_TASK_TYPE_BATCH_CHANGE_WAREHOUSE=<span class="string">"转入仓库"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String INSPECTION_TASK_TYPE_BATCH_CHANGE_SHIPPING=<span class="string">"开始配送"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>测试结果</em></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20191101163656904.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure><p>这里执行的是转入仓库的业务</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;设计模式-策略模式&quot;&gt;&lt;a href=&quot;#设计模式-策略模式&quot; class=&quot;headerlink&quot; title=&quot;设计模式-策略模式&quot;&gt;&lt;/a&gt;设计模式-策略模式&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;hea
      
    
    </summary>
    
    
      <category term="设计模式" scheme="http://blog.loveyx815.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="http://blog.loveyx815.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="策略模式" scheme="http://blog.loveyx815.cn/tags/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ消息队列-初识</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/mq/RocketMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/mq/RocketMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T07:49:10.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="RocketMQ消息队列"><a href="#RocketMQ消息队列" class="headerlink" title="RocketMQ消息队列"></a>RocketMQ消息队列</h1><p>[TOC]</p><blockquote><p>简介：RocketMQ具有灵活的扩展性、海量消息堆积能力、支持顺序消息、支持多种消息过滤方式、支持事务消息、支持回溯消费。</p></blockquote><blockquote><p>四大核心组件：NameServer、Broker、Producer、Consumer，每个组件都可以部署成集群模式进行水平扩展。</p></blockquote><ul><li><p><strong>Producer</strong></p><p>生产者负责生产消息，Rocketmq提供了同步、异步、单向三种方式发送消息。</p></li><li><p><strong>Consumer</strong></p><p>消费者负责消费消息，从消息服务器拉取消息并将其输入用户应用程序。</p></li><li><p><strong>Broker</strong></p><p>消息服务器是消息存储中心，主要用于接收生产者的消息进行存储，消费者从这里获取消息。并且还存储与消息有关的元数据（包括用户组、消费进度偏移量、队列信息等）</p></li><li><p><strong>NameServer</strong></p><p>名称服务器用来保存Broker相关元信息并给生产者和消费者查找Broker信息。</p></li></ul><h2 id="1-环境搭建"><a href="#1-环境搭建" class="headerlink" title="1.环境搭建"></a>1.环境搭建</h2><p>（1）</p><p><a href="http://rocketmq.apache.org" target="_blank" rel="noopener">从官网下载RocketMQ服务包</a> ,将其解压至服务器目录</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200130143231879.png" alt="1580280760569" title="">                </div>                <div class="image-caption">1580280760569</div>            </figure><p>，启动nameserver和broker服务（需要安装好JDK环境，没装的话先移步安装JDK）。</p><p>（2）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">后台启动nameserver</span></span><br><span class="line">nohup sh bin/mqnamesrv &amp;</span><br></pre></td></tr></table></figure><p>观察启动目录下的nohup.out日志文件，是否启动成功！</p><p>这里我使用的是默认的配置环境进行启动，结果报错了，日志显示如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: Using the DefNew young collector with the CMS collector is deprecated and will likely be removed in a future release</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: UseCMSCompactAtFullCollection is deprecated and will likely be removed in a future release.</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: INFO: os::commit_memory(0x00000006c0000000, 2147483648, 0) failed; error='Cannot allocate memory' (errno=12)</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> There is insufficient memory <span class="keyword">for</span> the Java Runtime Environment to <span class="built_in">continue</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Native memory allocation (mmap) failed to map 2147483648 bytes <span class="keyword">for</span> committing reserved memory.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> An error report file with more information is saved as:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /home/rocketmq-all-4.6.0-bin-release/bin/hs_err_pid7597.log</span></span><br></pre></td></tr></table></figure><p>说是内存分配不足。</p><ul><li>解决方案：查看<strong>mqnamesrv</strong>脚本，最后运行了<strong>runserver.sh</strong>，所以我们修改<strong>runserver.sh</strong>这个脚本的运行空间，找到<strong>JAVA_OPT</strong>这一行，修改成</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPT="$&#123;JAVA_OPT&#125; -server -Xms128m -Xmx128m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"</span><br></pre></td></tr></table></figure><p>内存大小可根据实际情况设定。</p><p>（3）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">后台启动broker</span></span><br><span class="line">nohup sh bin/mqborker -n ip:9876 &amp;</span><br></pre></td></tr></table></figure><p>观察启动目录下的nohup.out日志文件，是否启动成功！</p><p>我这里日志显示内存不够失败，参考（2）中的解决方案，修改<strong>runbroker.sh</strong>的运行内存参数，再查看日志文件，启动成功！</p><h2 id="2-实现生产者和消费者"><a href="#2-实现生产者和消费者" class="headerlink" title="2.实现生产者和消费者"></a>2.实现生产者和消费者</h2><blockquote><p>这里采用推送型消费模式进行消息消费，需要在消费者启动的过程中注册一个消息监听器，监听订阅消息的获取。    </p></blockquote><p>消费者：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//创建一个消费者，帮你设置一个消费者组</span></span><br><span class="line">        DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(<span class="string">"shi_consumer_group"</span>);</span><br><span class="line">        <span class="comment">//指定nameserver 地址</span></span><br><span class="line">        consumer.setNamesrvAddr(<span class="string">"ip:9876"</span>);</span><br><span class="line">        <span class="comment">//设置consumer第一次启动时从队列首或尾开始消费</span></span><br><span class="line">        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET);</span><br><span class="line">        <span class="comment">//订阅指定Topic下的所有消息</span></span><br><span class="line">        consumer.subscribe(<span class="string">"topic_example_java"</span>,<span class="string">"*"</span>);</span><br><span class="line">        <span class="comment">//注册消息监听器</span></span><br><span class="line">        consumer.registerMessageListener(</span><br><span class="line">                <span class="keyword">new</span> MessageListenerConcurrently()&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">//默认list里只有一条消息，可以通过设置参数来批量接受消息</span></span><br><span class="line">                        <span class="keyword">if</span> (list != <span class="keyword">null</span>)&#123;</span><br><span class="line">                            <span class="keyword">for</span> (MessageExt ext:list)&#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    System.out.println(<span class="keyword">new</span> Date()+<span class="keyword">new</span> String(ext.getBody(),<span class="string">"UTF-8"</span>));</span><br><span class="line">                                &#125;<span class="keyword">catch</span> (UnsupportedEncodingException e)&#123;</span><br><span class="line">                                    e.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            System.out.println(<span class="string">"么有监听到消息。。。"</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//消费者对象在使用之前必须要调用start方法初始化</span></span><br><span class="line">        consumer.start();</span><br><span class="line">        System.out.println(<span class="string">" Consumer started..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消息生产者：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MQClientException, UnsupportedEncodingException, RemotingException, InterruptedException, MQBrokerException </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个消息生产者，并设置一个消息生产组</span></span><br><span class="line">        DefaultMQProducer producer =<span class="keyword">new</span> DefaultMQProducer(<span class="string">"shi_producer_group"</span>);</span><br><span class="line">        <span class="comment">//指定nameSERVER地址</span></span><br><span class="line">        producer.setNamesrvAddr(<span class="string">"ip:9876"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化producer，在整个生命周期中只需要初始化一次</span></span><br><span class="line">        producer.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">0</span> ;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">            <span class="comment">//创建一个消息对象，指定其主题、标签、消息内容</span></span><br><span class="line">            Message message = <span class="keyword">new</span> Message(</span><br><span class="line">                    <span class="string">"topic_example_java"</span>, <span class="comment">//消息主题</span></span><br><span class="line">                    <span class="string">"TagA"</span>,<span class="comment">//消息标签</span></span><br><span class="line">                    (<span class="string">"Hello Java demo rocketMQ"</span>+i).getBytes(RemotingHelper.DEFAULT_CHARSET)<span class="comment">//消息内容</span></span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//发送消息并返回结果</span></span><br><span class="line">            SendResult  sendResult = producer.send(message);</span><br><span class="line">            System.out.printf(<span class="string">"%s%n"</span>,sendResult);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//一旦生产者实例不再被使用，则将其关闭，包括清理资源、关闭网络连接等</span></span><br><span class="line">        producer.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分别启动消费者和生产者，生产者发布携带topic的消息，消费者去订阅该topic，通过监听，即可获取消息。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200130143216762.png" alt="1580363958517" title="">                </div>                <div class="image-caption">1580363958517</div>            </figure><p>生产者生产的100条消息已经被消费了</p><p>通过rocketmq-console可视化界面可以看到消费信息已产生</p><blockquote><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200130143156761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="1580364346073" title="">                </div>                <div class="image-caption">1580364346073</div>            </figure></blockquote><blockquote><p>这里提下rocketmq-console是rocketmq官方开源的控制台项目，可以监测mq运行情况。可以通过<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener">rocketmq官方的github</a>的release-rocketmq-console-1.0.0分支获取该源码。</p></blockquote><p>这里有个地方需要注意，很多资料上写的都是本机配置rocketmq，所以他们启动的都是localhost:9876这个broker，包括在代码中生产者、消费者制定nameserver地址也是localhost:9876。</p><p><strong>使用云服务器部署mq的或者想使用虚拟机ip的需要注意了：</strong></p><ol><li><p>如若启动了mqnamesrv和mqbroker这两个服务，先杀掉。然后修改rocketmq解压目录下conf/broker.conf，新增个<strong>brokerIP1=你的服务器公网ip</strong> 。</p><ol start="2"><li><p>启动mqnamesrv和mqbroker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">启动mqnamesrv</span></span><br><span class="line">nohup sh bin/mqnamesrv &amp;</span><br><span class="line"><span class="meta">#</span><span class="bash">启动mqbroker，-c可以自定义配置文件启动，这里使用上面修改conf/borker.conf</span></span><br><span class="line">nohup sh bin/mqbroker -n localhost:9876 -c conf/broker.conf</span><br></pre></td></tr></table></figure></li><li><p><strong>服务器防火墙放行9876和10911端口，云服务器设置安全组规则，同样放行9876和10911</strong>（画重点，血的教训）<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200130143041727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="1580365573265" title="">                </div>                <div class="image-caption">1580365573265</div>            </figure></p><p>之前不知道为什么就设置了10909端口，后来消息可以生产但无法消费。一直以为自己的端口都放开了，弄了半天发现还是端口没放开。。。</p></li></ol></li></ol><h2 id="3-基于Aop托管的实现"><a href="#3-基于Aop托管的实现" class="headerlink" title="3.基于Aop托管的实现"></a>3.基于Aop托管的实现</h2><blockquote><p>把生产者和消费者的实例放入spring bean中，利用Aop进行管理，方便调用</p></blockquote><ol><li><p>新建生产者、消费者和监听器bean.</p><p>生产者bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/01/30 15:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: spring IoC实现生产者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringProducer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String producerGroupName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nameServerAddr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DefaultMQProducer producer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpringProducer</span><span class="params">(String producerGroupName, String nameServerAddr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.producerGroupName = producerGroupName;</span><br><span class="line">        <span class="keyword">this</span>.nameServerAddr = nameServerAddr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始启动消息生产者服务。。。"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个消息生产者，并设置一个消息生产者组</span></span><br><span class="line">        producer = <span class="keyword">new</span> DefaultMQProducer(producerGroupName);</span><br><span class="line">        <span class="comment">//指定nameserver地址</span></span><br><span class="line">        producer.setNamesrvAddr(nameServerAddr);</span><br><span class="line">        producer.start();</span><br><span class="line">        logger.info(<span class="string">"消息生产者服务启动成功。"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Description: 销毁对象</span></span><br><span class="line"><span class="comment"> * @Param: []</span></span><br><span class="line"><span class="comment"> * @Return: void</span></span><br><span class="line"><span class="comment"> * @Author: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * @Date: 2020/1/30/030 下午 4:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始关闭消息生产者服务。。"</span>);</span><br><span class="line">        producer.shutdown();</span><br><span class="line">        logger.info(<span class="string">"消息生产者服务已关闭"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultMQProducer <span class="title">getProducer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> producer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消费者bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/01/30 16:29</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringCousumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger =LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String consumerGroupName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nameServerAddr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String topicName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DefaultMQPushConsumer consumer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MessageListenerConcurrently messageListenerConcurrently;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpringCousumer</span><span class="params">(String consumerGroupName,String nameServerAddr,String topicName,MessageListenerConcurrently messageListener)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.consumerGroupName=consumerGroupName;</span><br><span class="line">        <span class="keyword">this</span>.nameServerAddr=nameServerAddr;</span><br><span class="line">        <span class="keyword">this</span>.topicName=topicName;</span><br><span class="line">        <span class="keyword">this</span>.messageListenerConcurrently=messageListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始启动消费者服务。。"</span>);</span><br><span class="line">        consumer=<span class="keyword">new</span> DefaultMQPushConsumer(consumerGroupName);</span><br><span class="line">        consumer.setNamesrvAddr(nameServerAddr);</span><br><span class="line">        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET);</span><br><span class="line">        consumer.subscribe(topicName,<span class="string">"*"</span>);</span><br><span class="line">        consumer.registerMessageListener(messageListenerConcurrently);</span><br><span class="line">        consumer.start();</span><br><span class="line">        logger.info(<span class="string">"消费者服务已启动。。。"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始关闭消息者服务。。。"</span>);</span><br><span class="line">        consumer.shutdown();</span><br><span class="line">        logger.info(<span class="string">"消费者服务已关闭！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultMQPushConsumer <span class="title">getConsumer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> consumer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消息监听器bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/01/30 17:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 消息监听逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageListener</span> <span class="keyword">implements</span> <span class="title">MessageListenerConcurrently</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger =LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (list!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (MessageExt ext : list)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    logger.info(<span class="string">"监听到消息："</span>+<span class="keyword">new</span> String(ext.getBody(),<span class="string">"UTF-8"</span>));</span><br><span class="line">                &#125;<span class="keyword">catch</span> (UnsupportedEncodingException e)&#123;</span><br><span class="line">                    logger.info(<span class="string">"解码异常"</span>+e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>由于本项目是基于springboot开发，这里直接新建个config配置类，注入上面建的bean</p><p><strong>注意：</strong>下面的nameserver的ip需改成自己实际环境的ip</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/01/30 17:26</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 消息生产者实例配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @Description: 生产者实例化</span></span><br><span class="line"><span class="comment">     * @Param: []</span></span><br><span class="line"><span class="comment">     * @Return: cn.loveyx815.rocketmq.spring.SpringProducer</span></span><br><span class="line"><span class="comment">     * @Author: Yonggang Shi</span></span><br><span class="line"><span class="comment">     * @Date: 2020/1/30/030 下午 5:35</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(initMethod = <span class="string">"init"</span>,destroyMethod = <span class="string">"destroy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpringProducer <span class="title">getProducer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpringProducer(<span class="string">"spring_producer_group"</span>,<span class="string">"ip:9876"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"messageListener"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MessageListener <span class="title">messageListener</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> MessageListener();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(initMethod = <span class="string">"init"</span>,destroyMethod = <span class="string">"destory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpringCousumer <span class="title">getCousumer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//ApplicationContext context =</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpringCousumer(<span class="string">"spring_producer_group"</span>,<span class="string">"ip:9876"</span>,<span class="string">"spring-rocketMQ-topic"</span>,messageListener());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>到此为止，准备工作都已完成，现在写两个单元测试进行验证下代码是否有问题</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/01/31 14:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 消费者单测</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConsumerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpringCousumer cousumer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">consume</span><span class="params">()</span> <span class="keyword">throws</span>  Exception </span>&#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>*<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        cousumer.getConsumer().shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/01/31 14:44</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 生产者单测</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringProducerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpringProducer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line">            Message message = <span class="keyword">new</span> Message(</span><br><span class="line">                    <span class="string">"spring-rocketMQ-topic"</span>,</span><br><span class="line">                    <span class="keyword">null</span>,</span><br><span class="line">                    (<span class="string">"spring-RocketMQ-demo"</span>+i).getBytes(RemotingHelper.DEFAULT_CHARSET)</span><br><span class="line">            );</span><br><span class="line">            SendResult sendResult = producer.getProducer().send(message);</span><br><span class="line"></span><br><span class="line">            System.out.printf(<span class="string">"%s%n"</span>,sendResult);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>最后启动两个test，得到输出信息</p><p><img src="https://img-blog.csdnimg.cn/2020020115460184.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="1580526909818"></p></li></ol><h2 id="4-消息顺序处理"><a href="#4-消息顺序处理" class="headerlink" title="4.消息顺序处理"></a>4.消息顺序处理</h2><blockquote><p>在业务中可能需要按照顺序消费的场景，而RocketMQ本身就支持这种顺序消费。</p><p>如电商系统中订单产生-加入购物车-将下单消息写入消息队列-用户取消-将取消订购的消息加入消息队列-从队列中消费订购消息-从队列中消费取消订购消息-<strong>往数据库中写入订购消息-从数据库中删除订购消息</strong>，在最后写入数据库和从数据库删除操作时，必须按照消息顺序执行，否则就会发生取消操作失败。</p><p>实际上与之前的生产消费类似，下面仅介绍下需要注意的地方。</p></blockquote><ul><li><p>消息生产者bean注入的时候，需要实例化一个<strong>消息队列选择器（MessageQueueSelector）</strong>，新建个选择器类实现<strong>MessageQueueSelector</strong>这个接口，自定义消息存储的规则，那些消息会进入同一个队列。实际调用生产者发送消息的时候send()，传入<strong>新建消息选择器</strong>的对象和对应消息和参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> SendResult <span class="title">send</span><span class="params">(Message msg, MessageQueueSelector selector, Object arg)</span> <span class="keyword">throws</span> MQClientException, RemotingException, MQBrokerException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.defaultMQProducerImpl.send(msg, selector, arg);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>通过实现这个重载方法来进入消息队列</p></li><li><p>消费者bean注入不同的是，消息监听器的实现接口不同，原来是用<strong>MessageListenerConcurrently</strong>，这种消息消费是无序的，所以我们想要有序的需实现<strong>MessageListenerOrderly</strong></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;RocketMQ消息队列&quot;&gt;&lt;a href=&quot;#RocketMQ消息队列&quot; class=&quot;headerlink&quot; title=&quot;RocketMQ消息队列&quot;&gt;&lt;/a&gt;RocketMQ消息队列&lt;/h1&gt;&lt;p&gt;[TOC]&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;简介：R
      
    
    </summary>
    
    
      <category term="MQ" scheme="http://blog.loveyx815.cn/categories/MQ/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="MQ" scheme="http://blog.loveyx815.cn/tags/MQ/"/>
    
      <category term="分布式" scheme="http://blog.loveyx815.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ消息队列-分布式事务</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/mq/RocketMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B9%8B%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/mq/RocketMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B9%8B%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T07:49:42.624Z</updated>
    
    <content type="html"><![CDATA[<h1 id="RocketMQ消息队列"><a href="#RocketMQ消息队列" class="headerlink" title="RocketMQ消息队列"></a>RocketMQ消息队列</h1><p>[TOC]</p><h2 id="基于RocketMQ的分布式事务"><a href="#基于RocketMQ的分布式事务" class="headerlink" title="基于RocketMQ的分布式事务"></a>基于RocketMQ的分布式事务</h2><blockquote><p>在介绍RocketMQ的分布式事务之前，先来了解下什么事分布式事务？</p></blockquote><h2 id="一、分布式事务"><a href="#一、分布式事务" class="headerlink" title="一、分布式事务"></a>一、分布式事务</h2><ul><li><p>简介</p><blockquote><p>在分布式系统中，不止使用一个数据库，比如订单系统使用db_order数据库，产品系统使用的是db_product数据库，在订单系统中只能保证订单相关操作的事务，在产品系统中只能保证产品相关操作的事务。比如：如果在订单系统中进行生成订单、扣减库存的业务，如果出现异常，那么创建订单的事务会回滚，而扣减库存的事务则不会，因为本地事务是不能夸数据库的。跨库的事务就属于分布式事务。</p><p>把分布式系统中两个相关操作看成是一个单元，比如创建订单和修改库存的操作，该单元要么一起成功，要么一起失败，这就是分布式事务。</p></blockquote></li><li><p>关于分布式事务你不得不知的两个理论：</p></li></ul><blockquote><p>1、CAP定理<br>CAP原则又称CAP定理，指的是在一个分布式系统中，WEB服务无法同时满足以下3个特性：</p><p>一致性(Consistency) ： 在分布式系统中数据一旦更新，所有数据变动都是同步的</p><p>可用性(Availability) ： 好的响应性能，每个操作都必须有预期的响应结束</p><p>分区容错性(Partition tolerance) ： 在网络分区的情况下，即使出现单个节点无法可用，系统依然正常对外提供服务</p><p>首先在分布式系统中，横向扩展策略依赖于数据分区，所以一般会在一致性和可用性上做出牺牲。</p><p>2、BASE理论<br>BASE理论中的三个特性：</p><p>Basically Available（基本可用）</p><p>Soft state（软状态）</p><p>Eventually consistent（最终一致性）</p><p>三个特性分别指的是：</p><p>（1）基本可用是指分布式系统在出现不可预知的故障的时候，允许损失部分可用性——但请注意，这绝不等价于系统不可用。</p><p>（2）软状态，和硬状态对应，是指允许系统中的数据存在中间状态，并认为该中间状态的存在不会影响系统的整体可用性，即允许系统不同节点的数据副本之间进行数据同步的过程存在延时。</p><p>（3）最终一致性强调的是系统所有的数据副本，在经过一段时间的同步后，最终能够达到一个一致的状态。因此，最终一致性的本质是需要系统保证最终数据能够达到一致，而不需要试试保证系统数据的强一致性。</p><p>BASE理论是对CAP中的一致性和可用性进行一个权衡的结果，理论的核心思想就是：我们无法做到强一致，但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性（Eventual consist  ency）。<br>————————————————<br>版权声明：本文为CSDN博主「坏菠萝」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/abcwanglinyong/article/details/82116669" target="_blank" rel="noopener">https://blog.csdn.net/abcwanglinyong/article/details/82116669</a></p></blockquote><h2 id="二、分布式事务解决方案"><a href="#二、分布式事务解决方案" class="headerlink" title="二、分布式事务解决方案"></a>二、分布式事务解决方案</h2><blockquote><p>分布式事务解决方案有很多种，这里针对RocketMQ本身介绍下<strong>两阶段提交</strong>（2PC）。因为本身RocketMQ的分布式事务消息就是基于消息中间件模拟的两阶段提价（2PC）。</p></blockquote><ul><li>主要分为以下几个步骤</li></ul><ol><li><p>系统A先向消息中间件发送一条预备消息，消息中间件保存还该消息后向系统A发送确认消息</p></li><li><p>系统A接收到MQ的确认消息后，执行本地事务</p></li><li><p>系统A根据本地事务执行结果再向MQ发送提交信息，以提交二次确认</p></li><li><p>MQ收到二次确认消息后，不预备消息标记为可投递，订阅者最终讲接收到该消息</p></li></ol><ul><li>在这过程中是如何进行回滚操作？</li></ul><ol><li><p>在本地事务未执行之前，也就是上面的1和2出错的话，不会进入后面的阶段，也就不会有问题</p></li><li><p>第3步出错系统A会实现一个消息回查接口，MQ服务端在等不到系统A反馈时会轮询该消息回查接口，检查系统A的本地事务执行结果。如果事务成功执行则进入下个阶段，否则回滚到第一步中。</p></li><li><p>第4布出错，此时系统A的本地事务已经提交成功，MQ服务端通过回查接口能够检查到该事务执行成功，那么由MQ服务端将预备消息标记为可投递，从而完成消息事务的处理。</p><p>至此可实现跨系统是分布式事务了。</p></li></ol><blockquote><p>整体的分布式事务被拆分成一个消息事务（系统A的本地事务+发消息）+系统B的本地事务，系统B的操作由消息驱动，这样系统A和系统B的事务便绑定在一起。</p></blockquote><ul><li><p>RocketMQ整体交互流程图如下：</p><p><img src="https://img-blog.csdnimg.cn/20200206105854909.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="9873681-1e6612b094cb561d"></p></li></ul><ol><li>事务发起方首先发送准本预备消息到MQServer</li><li>MQServer向事务发起方ACK确认消息发送成功</li><li>事务发起方接收到确认消息后执行事务</li><li>事务发起方根据本地事务的执行结果返回commit或rollback给MQserver。如果发送的是rollback，则MQ将删除该预备消息不进行下发；否则MQ会把该预备消息发送给Consumer</li><li>如果在执行本地事务过程中该应用挂了或者超时，第4步提交的二次确认消息最终没有到达MQServer，MQServer将在经过一定时间后对该消息发起消息回查，通过不停的询问同组的其他的Producer来获取状态</li><li>发送方接受到回查消息后查询对应消息的本地事务执行结果</li><li>根据回查的本地事务的最终执行结果再次提交二次确认</li><li>消费端的消息成功机制是由MQ保证的 </li></ol><h2 id="三、RocketMQ事务消息实例"><a href="#三、RocketMQ事务消息实例" class="headerlink" title="三、RocketMQ事务消息实例"></a>三、RocketMQ事务消息实例</h2><p><strong>建议大家使用MQ的时候要选择MQ版本4.3以上的，而且pom文件引入的rocketmq-client版本号要与你服务器上的版本号一致，否则可能会出现No route info of this topic这样的异常信息，被这个坑惨了</strong></p><ul><li><p>事务消息生产者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/02/03 17:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionProducer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  Logger logger = LoggerFactory.getLogger(TransactionProducer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        TransactionMQProducer producer = <span class="keyword">new</span> TransactionMQProducer(<span class="string">"transaction_producer_group"</span>);</span><br><span class="line"></span><br><span class="line">        producer.setNamesrvAddr(Consts.MQ_ADDR);</span><br><span class="line">        ExecutorService executorService = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">5</span>, <span class="number">100</span>, TimeUnit.SECONDS, <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">2000</span>), (Runnable r) -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(r);</span><br><span class="line">            thread.setName(<span class="string">"client-transaction-msg-check-thread"</span>);</span><br><span class="line">            <span class="keyword">return</span> thread;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//设置本地事务执行的线程池</span></span><br><span class="line">        producer.setExecutorService(executorService);</span><br><span class="line">        producer.setTransactionListener(<span class="keyword">new</span> TransactionListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> LocalTransactionState <span class="title">executeLocalTransaction</span><span class="params">(Message message, Object o)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//本地事务处理逻辑</span></span><br><span class="line">                logger.info(<span class="string">"本地事务执行。。。"</span>);</span><br><span class="line">                logger.info(<span class="string">"消息标签："</span>+<span class="keyword">new</span> String(message.getTags()));</span><br><span class="line">                logger.info(<span class="string">"消息内容："</span>+<span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">                String tag = message.getTags();</span><br><span class="line">                <span class="keyword">if</span> (tag.equals(<span class="string">"Transaction1"</span>))&#123;</span><br><span class="line">                    <span class="comment">//消息的标签如果是Transaction1,则返回事务失败标记</span></span><br><span class="line">                    logger.error(<span class="string">"模拟本地事务执行失败"</span>);</span><br><span class="line">                    <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">                &#125;</span><br><span class="line">                logger.info(<span class="string">"模拟本地事务成功"</span>);</span><br><span class="line">                <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> LocalTransactionState <span class="title">checkLocalTransaction</span><span class="params">(MessageExt messageExt)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//消息回查接口</span></span><br><span class="line">                logger.info(<span class="string">"服务器调用消息回查接口"</span>);</span><br><span class="line">                logger.info(<span class="string">"消息标签："</span>+<span class="keyword">new</span> String(messageExt.getTags()));</span><br><span class="line">                logger.info(<span class="string">"消息内容："</span>+<span class="keyword">new</span> String(messageExt.getBody()));</span><br><span class="line">                <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        producer.start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">0</span> ;i&lt;<span class="number">2</span>;i++)&#123;</span><br><span class="line">            Message message=<span class="keyword">new</span> Message(<span class="string">"TopicTransaction"</span>,<span class="string">"Transaction"</span>+i,(<span class="string">"Hello Rocakmq transaction"</span>).getBytes());</span><br><span class="line">            SendResult sendResult =producer.sendMessageInTransaction(message,<span class="keyword">null</span>);</span><br><span class="line">            logger.info(String.valueOf(sendResult));</span><br><span class="line">            logger.info(<span class="string">""</span>);</span><br><span class="line">            TimeUnit.MICROSECONDS.sleep(<span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">0</span> ;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        producer.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>与普通生产者不同的地方是，这里需要调用<strong>setTransactionListener</strong>方法，通过自己实现<strong>TransactionListener</strong>接口的<strong>executeLocalTransaction</strong>执行本地事务和<strong>checkLocalTransaction</strong>消息回查方法</p></blockquote><p>执行结果说明有个事务消息挂了，实际上发送过去的就只有一条</p><p><img src="https://img-blog.csdnimg.cn/20200206110228640.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="1580798226922"></p></li><li><p>事务消息消费者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/02/03 22:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>   Logger logger = LoggerFactory.getLogger(TransactionConsumer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MQClientException </span>&#123;</span><br><span class="line">        DefaultMQPushConsumer consumer =<span class="keyword">new</span> DefaultMQPushConsumer(<span class="string">"transaction_consumer_group"</span>);</span><br><span class="line">        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET);</span><br><span class="line">        consumer.setNamesrvAddr(Consts.MQ_ADDR);</span><br><span class="line">        consumer.subscribe(<span class="string">"TopicTransaction"</span>,<span class="string">"*"</span>);</span><br><span class="line">        consumer.registerMessageListener(<span class="keyword">new</span> MessageListenerConcurrently() &#123;</span><br><span class="line">            <span class="keyword">private</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (MessageExt msg: list) &#123;</span><br><span class="line">                    logger.info(<span class="string">"消息消费者接收到消息"</span>+msg);</span><br><span class="line">                    logger.info(<span class="string">"接收到的消息标签："</span>+<span class="keyword">new</span> String(msg.getTags()));</span><br><span class="line">                    logger.info(<span class="string">"接收到消息内容："</span>+<span class="keyword">new</span> String(msg.getBody()));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//模拟业务处理</span></span><br><span class="line">                    TimeUnit.SECONDS.sleep(random.nextInt(<span class="number">5</span>));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="keyword">return</span>  ConsumeConcurrentlyStatus.RECONSUME_LATER;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行事务消息消费者，仅消费了<strong>Transaction0</strong>，说明本地事务消息失败的没有被发过来</p><p><img src="https://img-blog.csdnimg.cn/20200206110235659.png" alt="1580798597842"></p></li></ul><h2 id="四、分布式事务实现新用户注册送积分"><a href="#四、分布式事务实现新用户注册送积分" class="headerlink" title="四、分布式事务实现新用户注册送积分"></a>四、分布式事务实现新用户注册送积分</h2><blockquote><p>背景介绍：新用户注册赠送积分。这里的流程就是把用户表格积分表分别放在不同的库，实现两者的跨库事务操作。</p></blockquote><p>这里我们主要介绍下核心代码，完整的源码可以follow<a href="https://github.com/rainandsunshine/Poet.git" target="_blank" rel="noopener">我的大型仓库</a> <a href="https://github.com/rainandsunshine/Poet.git" target="_blank" rel="noopener">https://github.com/rainandsunshine/Poet.git</a> </p><ul><li>下面分为两块，一个是配置双数据源，单个数据源不能实现跨库操作；二是RocketMQ的分布式事务在具体业务中如何实现。</li></ul><ol><li><p>配置双数据源，也就是一个系统里面连接两个库。这个项目使用的是JdbcTemplate作为持久层的开发，在SpringBoot中直接新建个配置类，给数据源都绑定好。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/02/04 22:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 双数据源配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"testDataSource"</span>)</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"testDataSource"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"spring.datasource.hikari.mysql"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">testDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"formalDataSource"</span>)</span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"formalDataSource"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.formal.mysql"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">formalDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"testJdbcTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">testJdbcTemplate</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @Qualifier(<span class="string">"testDataSource"</span>)</span>  DataSource testDataSource ) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(testDataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"formalJdbcTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">formalJdbcTemplate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @Qualifier(<span class="string">"formalDataSource"</span>)</span> DataSource formalDataSource)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(formalDataSource);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @Description:用户DAO层bean， 通过参数注入对应的jdbctemplate，实现对库绑定</span></span><br><span class="line"><span class="comment">     * @Param: [jdbcTemplate]</span></span><br><span class="line"><span class="comment">     * @Return: cn.loveyx815.rocketmq.mqtransaction.dao.UserDao</span></span><br><span class="line"><span class="comment">     * @Author: Yonggang Shi</span></span><br><span class="line"><span class="comment">     * @Date: 2020/2/5/005 下午 11:57</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"userDao"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDao <span class="title">getUserDao</span><span class="params">(@Qualifier(<span class="string">"testJdbcTemplate"</span>)</span> JdbcTemplate jdbcTemplate)</span>&#123;</span><br><span class="line">        UserDao userDao =<span class="keyword">new</span> UserDao();</span><br><span class="line">        userDao.setJdbcTemplate(jdbcTemplate);</span><br><span class="line">        <span class="keyword">return</span>  userDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @Description:积分DAO层bean， 通过参数注入对应的jdbctemplate，实现对库绑定</span></span><br><span class="line"><span class="comment">     * @Param: [jdbcTemplate]</span></span><br><span class="line"><span class="comment">     * @Return: cn.loveyx815.rocketmq.mqtransaction.dao.UserDao</span></span><br><span class="line"><span class="comment">     * @Author: Yonggang Shi</span></span><br><span class="line"><span class="comment">     * @Date: 2020/2/5/005 下午 11:57</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"pointDao"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PointDao <span class="title">getPointDao</span><span class="params">(@Qualifier(<span class="string">"formalJdbcTemplate"</span>)</span> JdbcTemplate jdbcTemplate)</span>&#123;</span><br><span class="line">        PointDao pointDao =<span class="keyword">new</span> PointDao();</span><br><span class="line">        pointDao.setJdbcTemplate(jdbcTemplate);</span><br><span class="line">        <span class="keyword">return</span>  pointDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置多数据源一定有个主要的数据源，不然程序加载就不能识别默认的，导致报错。@<strong>Primary</strong>注解加在你想加的<strong>DataSource</strong>上。</p><p>先注入两个<strong>DataSource</strong>的bean后，再分别注入<strong>JdbcTemplate</strong>中，最后把持久层的userDAO和pointDAO分贝注入不同的<strong>Jdbctemplate</strong>的bean，这样就可以实现多数经验绑定了。</p></li><li><p>下面就是介绍事务消息生产者和消费者</p><blockquote><p>除了那些基本的配置之外，主要的是在事务消息可以实现分布式事务，基于<strong>2PC</strong>(二阶段提交)前文已经介绍过了。</p><p>特别的地方就是在消息生产者生产的时候需要添加个本地事务监听器，用来监听本地事务执行状态，然后再发送消息。</p><p>而消费者也需要自己实现<strong>MessageListenerConcurrently</strong>接口的方法，可以在消费消息的时候做一些业务处理</p></blockquote></li></ol><ul><li><p>消息监听器TransactionMessageListener</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/02/04 18:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 事务消息监听器，用作消费者消费的监听逻辑实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionMessageListener</span> <span class="keyword">implements</span> <span class="title">MessageListenerConcurrently</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PointService pointService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (MessageExt message:list)&#123;</span><br><span class="line">                logger.info(<span class="string">"消息消费者接收到消息:"</span>+message);</span><br><span class="line">                logger.info(<span class="string">"接收到消息内容:"</span>+<span class="keyword">new</span> String (message.getBody()));</span><br><span class="line">                <span class="comment">//从消息体中获取积分消息对象</span></span><br><span class="line">                UserPointMessage userPointMessage= JSON.parseObject(message.getBody(),UserPointMessage<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                <span class="keyword">if</span> (userPointMessage!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    Point point = <span class="keyword">new</span> Point();</span><br><span class="line">                    point.setUserId(userPointMessage.getUserId());</span><br><span class="line">                    point.setAmount(userPointMessage.getAmount());</span><br><span class="line">                    <span class="comment">//保存用户积分记录并提交本地事务</span></span><br><span class="line">                    pointService.savePoint(point);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            logger.error(<span class="string">"消息消费出错"</span>+e);</span><br><span class="line">            <span class="keyword">return</span>  ConsumeConcurrentlyStatus.RECONSUME_LATER;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//正常消费成功</span></span><br><span class="line">        <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>本地事务监听器UserLocalTransactionListener</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/02/04 18:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 本地事务监听器，用作生产者生产消息的逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserLocalTransactionListener</span> <span class="keyword">implements</span> <span class="title">TransactionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalTransactionState <span class="title">executeLocalTransaction</span><span class="params">(Message message, Object o)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//本地事务处理逻辑</span></span><br><span class="line">        logger.info(<span class="string">"本地事务执行。。。"</span>);</span><br><span class="line">        logger.info(<span class="string">"消息标签："</span>+<span class="keyword">new</span> String(message.getTags()));</span><br><span class="line">        logger.info(<span class="string">"消息内容："</span>+<span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">        <span class="comment">//从消息体重获取积分消息对象</span></span><br><span class="line">        UserPointMessage userPointMessage = JSON.parseObject(message.getBody(), UserPointMessage<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//保存用户记录并提交本地事务</span></span><br><span class="line">        userService.saveUser(userPointMessage.getUserId(),userPointMessage.getUserName());</span><br><span class="line">        <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalTransactionState <span class="title">checkLocalTransaction</span><span class="params">(MessageExt messageExt)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//消息回查接口</span></span><br><span class="line">        logger.info(<span class="string">"服务器调用消息回查接口"</span>);</span><br><span class="line">        logger.info(<span class="string">"消息标签："</span>+<span class="keyword">new</span> String(messageExt.getTags()));</span><br><span class="line">        logger.info(<span class="string">"消息内容："</span>+<span class="keyword">new</span> String(messageExt.getBody()));</span><br><span class="line">        <span class="comment">//从消息体重获取积分消息对象</span></span><br><span class="line">        UserPointMessage userPointMessage = JSON.parseObject(messageExt.getBody(),UserPointMessage<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">if</span> (userPointMessage!= <span class="keyword">null</span>)&#123;</span><br><span class="line">            String userId = userPointMessage.getUserId();</span><br><span class="line">            <span class="keyword">if</span> (userService.getById(userId) != <span class="keyword">null</span>)&#123;</span><br><span class="line">                logger.info(<span class="string">"本地插入用户表成功！"</span>);</span><br><span class="line"><span class="comment">//                表示本地事务执行成功</span></span><br><span class="line">                <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过使用@<strong>Component</strong>注解来标识这两个监听器注入Spring容器，然后在生产者、消费者配置类中分别引用这两个监听器bean。</p></li><li><p>生产者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/02/04 17:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 消息生产者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionSpringProducer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line">    <span class="keyword">private</span> String producerGroupName;</span><br><span class="line">    <span class="keyword">private</span> String nameServerAdd;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> corePoolSize = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maximumPoolSize = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> keepAliveTime = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> TransactionMQProducer producer;</span><br><span class="line">    <span class="keyword">private</span> TransactionListener transactionListener;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TransactionSpringProducer</span><span class="params">(String producerGroupName,String nameServerAdd,<span class="keyword">int</span> corePoolSize,<span class="keyword">int</span> maximumPoolSize,<span class="keyword">long</span> keepAliveTime,TransactionListener transactionListener)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.corePoolSize=corePoolSize;</span><br><span class="line">        <span class="keyword">this</span>.keepAliveTime=keepAliveTime;</span><br><span class="line">        <span class="keyword">this</span>.maximumPoolSize=maximumPoolSize;</span><br><span class="line">        <span class="keyword">this</span>.nameServerAdd=nameServerAdd;</span><br><span class="line">        <span class="keyword">this</span>.producerGroupName=producerGroupName;</span><br><span class="line">        <span class="keyword">this</span>.transactionListener=transactionListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始启动消息生产者服务。。。"</span>);</span><br><span class="line"></span><br><span class="line">        producer = <span class="keyword">new</span> TransactionMQProducer(producerGroupName);</span><br><span class="line">        producer.setNamesrvAddr(nameServerAdd);</span><br><span class="line">        ExecutorService executorService = <span class="keyword">new</span> ThreadPoolExecutor(corePoolSize,maximumPoolSize,keepAliveTime, TimeUnit.SECONDS,<span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">2000</span>),(Runnable r )-&gt;&#123;</span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(r);</span><br><span class="line">            thread.setName(<span class="string">"client-transaction-msg-check-thread"</span>);</span><br><span class="line">            <span class="keyword">return</span> thread;</span><br><span class="line">        &#125;);</span><br><span class="line">        producer.setExecutorService(executorService);</span><br><span class="line">        producer.setTransactionListener(transactionListener);</span><br><span class="line">        producer.start();</span><br><span class="line">        logger.info(<span class="string">"消息生产者已启动！！！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始关闭消息生产服务。。"</span>);</span><br><span class="line">        producer.shutdown();</span><br><span class="line">        logger.info(<span class="string">"生产者服务已关闭"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultMQProducer <span class="title">getProducer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> producer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>消费者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/02/04 18:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionSpringConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String consumerGropuName;</span><br><span class="line">    <span class="keyword">private</span> String nameServerAddr;</span><br><span class="line">    <span class="keyword">private</span> String topicName;</span><br><span class="line">    <span class="keyword">private</span> DefaultMQPushConsumer consumer;</span><br><span class="line">    <span class="keyword">private</span> MessageListenerConcurrently messageListener;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TransactionSpringConsumer</span><span class="params">(String consumerGropuName,String nameServerAddr,String topicName,MessageListenerConcurrently messageListener)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.consumerGropuName=consumerGropuName;</span><br><span class="line">        <span class="keyword">this</span>.messageListener=messageListener;</span><br><span class="line">        <span class="keyword">this</span>.nameServerAddr=nameServerAddr;</span><br><span class="line">        <span class="keyword">this</span>.topicName=topicName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span> <span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始启动消息消费者服务。。。"</span>);</span><br><span class="line">        consumer=<span class="keyword">new</span> DefaultMQPushConsumer(consumerGropuName);</span><br><span class="line">        consumer.setNamesrvAddr(nameServerAddr);</span><br><span class="line">        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET);</span><br><span class="line">        consumer.subscribe(topicName,<span class="string">"*"</span>);</span><br><span class="line">        consumer.registerMessageListener(messageListener);</span><br><span class="line">        consumer.start();</span><br><span class="line">        logger.info(<span class="string">"消息消费者服务启动成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始关闭消息消费者服务。。"</span>);</span><br><span class="line">        consumer.shutdown();</span><br><span class="line">        logger.info(<span class="string">"消费者服务已关闭"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  DefaultMQPushConsumer <span class="title">getConsumer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  consumer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>生产者、消费者配置类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/02/04 18:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionSpringConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String consumerGropuName;</span><br><span class="line">    <span class="keyword">private</span> String nameServerAddr;</span><br><span class="line">    <span class="keyword">private</span> String topicName;</span><br><span class="line">    <span class="keyword">private</span> DefaultMQPushConsumer consumer;</span><br><span class="line">    <span class="keyword">private</span> MessageListenerConcurrently messageListener;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TransactionSpringConsumer</span><span class="params">(String consumerGropuName,String nameServerAddr,String topicName,MessageListenerConcurrently messageListener)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.consumerGropuName=consumerGropuName;</span><br><span class="line">        <span class="keyword">this</span>.messageListener=messageListener;</span><br><span class="line">        <span class="keyword">this</span>.nameServerAddr=nameServerAddr;</span><br><span class="line">        <span class="keyword">this</span>.topicName=topicName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span> <span class="params">()</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始启动消息消费者服务。。。"</span>);</span><br><span class="line">        consumer=<span class="keyword">new</span> DefaultMQPushConsumer(consumerGropuName);</span><br><span class="line">        consumer.setNamesrvAddr(nameServerAddr);</span><br><span class="line">        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET);</span><br><span class="line">        consumer.subscribe(topicName,<span class="string">"*"</span>);</span><br><span class="line">        consumer.registerMessageListener(messageListener);</span><br><span class="line">        consumer.start();</span><br><span class="line">        logger.info(<span class="string">"消息消费者服务启动成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        logger.info(<span class="string">"开始关闭消息消费者服务。。"</span>);</span><br><span class="line">        consumer.shutdown();</span><br><span class="line">        logger.info(<span class="string">"消费者服务已关闭"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  DefaultMQPushConsumer <span class="title">getConsumer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  consumer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就已经完成了分布式事务生产消费的工作，还有相关的service和dao代码就不贴了，<a href="https://github.com/rainandsunshine/Poet.git" target="_blank" rel="noopener">这里</a> 都有！</p></li></ul></li><li><p>单元测试分布式事务生产消费</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Yonggang Shi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/02/04 23:24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= &#123;RocketmqApplication<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MQConfigTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">newUser</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        userService.newUserAndPoint(<span class="string">"分布式事务测试"</span>,<span class="number">100</span>);</span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果如下</p></li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200206110253237.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="1580921850968" title="">                </div>                <div class="image-caption">1580921850968</div>            </figure><p>我们再 看下两个库是否也更新了</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200206110258342.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="1580922010823" title="">                </div>                <div class="image-caption">1580922010823</div>            </figure><p>至此分布式事务已完成实现</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;RocketMQ消息队列&quot;&gt;&lt;a href=&quot;#RocketMQ消息队列&quot; class=&quot;headerlink&quot; title=&quot;RocketMQ消息队列&quot;&gt;&lt;/a&gt;RocketMQ消息队列&lt;/h1&gt;&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&quot;基于RocketMQ的分
      
    
    </summary>
    
    
      <category term="MQ" scheme="http://blog.loveyx815.cn/categories/MQ/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="MQ" scheme="http://blog.loveyx815.cn/tags/MQ/"/>
    
      <category term="分布式" scheme="http://blog.loveyx815.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>JVM复习</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/JVM/JVM%E5%A4%8D%E4%B9%A0/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/JVM/JVM%E5%A4%8D%E4%B9%A0/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T07:46:41.738Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JVM复习"><a href="#JVM复习" class="headerlink" title="JVM复习"></a>JVM复习</h1><blockquote><p>基于JDK1.7的研究</p></blockquote><h2 id="一、Java内存区域与内存溢出"><a href="#一、Java内存区域与内存溢出" class="headerlink" title="一、Java内存区域与内存溢出"></a>一、Java内存区域与内存溢出</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200226175738746.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>上图为jdk1.7的内存模型，下图借用下别人的1.8的图</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200226175825299.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure><ul><li><p>程序计数器</p><p>指示当前线程所执行的字节码的行号，编译字节码执行的命令，进而程序才能一步步的执行下去。</p></li><li><p>Java虚拟机栈</p><p>线程私有，生命周期与线程相同。</p><p>每个方法在执行时会创建一个<strong>栈帧</strong>用于存储局部变量表、操作数栈、动态链接、方法出口等。方法从调用到执行完成的过程中，就饿对应着一个栈帧在虚拟机栈中入栈到出栈的过程。</p><p><strong>局部变量表：</strong>存放了编译期间各基本数据类型、对象引用和returnAddress类型。其所需要的内存空间在编译期间完成分配，所以在方法运行期间是不会改变局部变量表的大小。</p></li><li><p>本地方法栈</p><p>与虚拟机栈类似，不同的是本地方法栈是为jvm调用Native方法服务。</p></li><li><p>Java堆</p><p>线程共享，存放对象实例。堆可以存在在物理上不连续，只要逻辑上连续就行。（GC在后面讲）</p></li><li><p>方法区</p><p>线程共享，用于存储已被JVM加载的类信息、常量、静态变量、即时编译器编译后的代码等数据</p></li><li><p>运行时常量池</p><p>方法区的一部分，存放Class文件在编译期间生产的各种字面常量和符号引用。Java中并非预置在Class文件中的常量池才会被放入常量池区。在运行期间也可以将新的常量放入该区域，如String类的intern()方法</p></li><li><p>直接内存</p><p>我理解的是为了方便JVM在Java堆和Native堆中来回复制数据设置的缓冲区。直接内存并不是JVM运行时数据区的一部分，这是一种基于通道和缓冲区的I/O方式。可以通过一个存储子啊Java堆中DirectByteBuffer对象作为这块内存的引用进行操作。</p></li></ul><h2 id="二、对象的创建"><a href="#二、对象的创建" class="headerlink" title="二、对象的创建"></a>二、对象的创建</h2><p>JVM接受到一个new的指令是，首先会去常量池中寻找该类的符号引用，然后检察这个符号引用代表的类是否已经加载、解析和初始化过。如果没有则先执行类加载过程。</p><ul><li><p>空间划分</p><p>通过类接在的检查后，JVM为该对象分配内存（内存大小在类加载完后就确定了）。若Java堆的空间是规整连续的采用的分配算法是“指针碰撞”，直接移动与对象大小相同的距离指针分配内存。否则采用“空闲列表”分配，对于堆空间非连续的，用一张空闲记录表记录当前空闲的内存块，在为对象分配内存的时候，从空闲表中找到合适的空间进行分配，同时更新空闲表。</p><p>内存分配完后，JVM将分配到内存的空间全都初始化为零，最后再执行<init>方法进行我们想要的初始化对象</p></li><li><p>对象的内存布局</p><p>在HotSpot虚拟机中，对象在内存中分为：对象头+实例数据+对齐填充。</p><p><strong>对象头</strong>：包含了两部分信息，一部分用于存储对象自身的运行时数据（哈希吗、GC年龄代、锁状态、线程持有的锁等）；另一部分是类型指针，即对象指向他的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。若对象是个数组，对象头中还需有一块用于记录数组长度的数据。</p><p><strong>实例数据</strong>：是对象真正存储的有效信息</p><p><strong>对齐填充</strong>：对象的大小必须是8的整数倍，当对象实例数据部分没有对齐时，就需要通过对齐填充来补全。</p></li></ul><h2 id="三、内存分配与回收"><a href="#三、内存分配与回收" class="headerlink" title="三、内存分配与回收"></a>三、内存分配与回收</h2><blockquote><p>大多数情况下，对象在新生代Eden区中分配，当Eden去没有足够的空间进行分配的时候虚拟机会进行MinorGC</p></blockquote><p>MinorGC：新生代GC，速度较快</p><p>FullGC/MajorGC：老年代GC，速度很慢</p><ul><li><p>大对象直接进入老年代</p><p>-XX:PretenureSizeThreshold  令大于这个设置的值得对象直接进入老年代 ，Serial、ParNew有效。避免在新生代不停地复制</p></li><li><p>存活久的对象将进入老年代</p><p>对象计数器：对象在Eden区出生并经过第一次MinorGC后任然存活，移动进入Survivor空间，且对象年龄设置为1。对象在survivor区中每熬过一次MinorGC，年龄+1。当年龄增加到阈值（默认15），就进入老年代。</p></li><li><p>动态对象年龄判定</p><p>当Survivor空间中相同年龄所有对象大小&gt;Survivor/2大小，年龄&gt;=该年龄的对象就可以直接进入老年代，无需等到年龄阈值</p></li><li><p>空间分配担保</p><p><strong>JDK 6 Update24之前：</strong></p><p>在MinorGC之前，JVM会检查老年代的最大连续可用空间是否大于新生代所有对象空间。</p><p><strong>大于</strong>：MinorGC是安全执行的</p><p><strong>否则</strong>：JVM会去查看HandlePromotionFailure设置值是否允许担保失败。</p><p>​    <strong>允许</strong>：检查老年代最大可用的连续空间是否大于历次晋升老年代对象的<strong>平均大小</strong></p><p>​            <strong>大于</strong>：尝试一次MinorGC</p><p>​            <strong>否则</strong>：进行FullGC</p><p>​    <strong>否则</strong>：进行FullGC</p><p><strong>JDK 6 Update24之后：</strong></p><p>只要老年代的连续空间大于新生代对象总大小或历次晋升的平均大小就会MinorGC，否则将进行FullGC</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;JVM复习&quot;&gt;&lt;a href=&quot;#JVM复习&quot; class=&quot;headerlink&quot; title=&quot;JVM复习&quot;&gt;&lt;/a&gt;JVM复习&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;基于JDK1.7的研究&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;一、Java内
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="JVM" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/JVM/"/>
    
    
      <category term="JVM" scheme="http://blog.loveyx815.cn/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>Docker从入坑到放弃</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/Docker/Docker%E4%BB%8E%E5%85%A5%E5%9D%91%E5%88%B0%E6%94%BE%E5%BC%83/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/Docker/Docker%E4%BB%8E%E5%85%A5%E5%9D%91%E5%88%B0%E6%94%BE%E5%BC%83/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T09:11:42.446Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker从入坑到放弃"><a href="#Docker从入坑到放弃" class="headerlink" title="Docker从入坑到放弃"></a>Docker从入坑到放弃</h1><ul><li><h2 id="环境安装问题"><a href="#环境安装问题" class="headerlink" title="环境安装问题"></a>环境安装问题</h2><p>  <strong>windows7安装docker异常</strong> ：looks like something went wrong in step ‘looking for vboxmanage.exe’<br>  <strong>解决方案</strong>：从安装目录的 <code>start.sh</code>脚本开始排查，很大可能是因为电脑的环境变量没有创建成功，所以需要把脚本对应的变量打印出来看看。</p></li></ul><blockquote><p>打印语句：<br>echo “$VBOX_MSI_INSTALL_PATH”<br>#“变量名称”<br>read param</p></blockquote><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20190802185759937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure><pre><code>**异常信息显示是‘looking for vboxmanage.exe’ ，所以 主要在这里排查，完善对应的变量名（这里已经是替换过的全命名路径了）**</code></pre><blockquote><p><strong>保存脚本后，在运行启动快捷方式</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20190802190246533.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure></blockquote><p><strong>运行成功</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Docker从入坑到放弃&quot;&gt;&lt;a href=&quot;#Docker从入坑到放弃&quot; class=&quot;headerlink&quot; title=&quot;Docker从入坑到放弃&quot;&gt;&lt;/a&gt;Docker从入坑到放弃&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;h2 id=&quot;环境安装问题&quot;&gt;&lt;a href=
      
    
    </summary>
    
    
      <category term="Docker" scheme="http://blog.loveyx815.cn/categories/Docker/"/>
    
    
      <category term="Docker" scheme="http://blog.loveyx815.cn/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Java异常-受查与非受查</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/summary/Java%E5%BC%82%E5%B8%B8/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/summary/Java%E5%BC%82%E5%B8%B8/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T07:45:37.818Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java异常-受查与非受查"><a href="#Java异常-受查与非受查" class="headerlink" title="Java异常-受查与非受查"></a>Java异常-受查与非受查</h1><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20200419145601997.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0d1aXRhcmY=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" title="">                </div>                <div class="image-caption">在这里插入图片描述</div>            </figure><blockquote><p>所有的异常都是由Throwable继承而来，下级分为Error和Exception</p></blockquote><ul><li><p><strong>Error</strong></p><p>Error表示Java运行时系统的内部错误和资源耗尽错误，不应该抛出该类型的错误，只能通知用户，尽力安全关闭程序。</p></li><li><p><strong>Exception</strong></p><p>该分支派生出RuntimeException和其他异常（如I/O错误之类）</p></li></ul><ol><li><strong>受查与非受查异常</strong></li></ol><ul><li><p><strong>非受查异常</strong></p><blockquote><p> 派生于Error或RuntimeException类的所有异常</p></blockquote></li><li><p><strong>受查异常</strong></p><blockquote><p>其他所有的异常称为受查异常</p></blockquote></li></ul><p>一个方法必须声明所有可能抛出的受查异常，非受查异常要么不可控制（Error），要么就应该避免（RuntimeException）。当方法没有声明所有可能发生的受查异常，编译器会发出一个错误消息。</p><ul><li><p><strong>try-catch</strong><br>除了常用的try-catch-finally之外，还有一种带资源的try语句</p><blockquote><p>若资源属于一个实现了AutoCloseable接口的类，该接口有个close方法 void close()  throws Exception;<br>整体的带资源的try语句可写成如下代码：</p></blockquote></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>(Resource res = ...)&#123;</span><br><span class="line">    <span class="keyword">do</span> something;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当try语句退出或者发生异常时，会自动调用res.close()，相当于调用了finally</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Java异常-受查与非受查&quot;&gt;&lt;a href=&quot;#Java异常-受查与非受查&quot; class=&quot;headerlink&quot; title=&quot;Java异常-受查与非受查&quot;&gt;&lt;/a&gt;Java异常-受查与非受查&lt;/h1&gt;&lt;figure class=&quot;image-bubble&quot;&gt;
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="异常处理" scheme="http://blog.loveyx815.cn/tags/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>maven项目pom.xml报错</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/summary/maven%E9%A1%B9%E7%9B%AEpom.xml%E6%8A%A5%E9%94%99/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/summary/maven%E9%A1%B9%E7%9B%AEpom.xml%E6%8A%A5%E9%94%99/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T09:06:18.844Z</updated>
    
    <content type="html"><![CDATA[<h1 id="maven项目pom-xml报错"><a href="#maven项目pom-xml报错" class="headerlink" title="maven项目pom.xml报错"></a>maven项目pom.xml报错</h1><blockquote><p>expected START_TAG or END_TAG not TEXT (position: TEXT seen …</dependency>\ua0\r\n &lt;d… @60:11) less… (Ctrl+F1)<br>Inspection info: Inspects a Maven model for resolution problems.</p></blockquote><p>  这种就是从别的地方复制粘贴的dependency时候有空格存在，导致文件识别不了，用IDE查找下空格的位置，删除就可以解决</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;maven项目pom-xml报错&quot;&gt;&lt;a href=&quot;#maven项目pom-xml报错&quot; class=&quot;headerlink&quot; title=&quot;maven项目pom.xml报错&quot;&gt;&lt;/a&gt;maven项目pom.xml报错&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;e
      
    
    </summary>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/categories/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="Java开发总结" scheme="http://blog.loveyx815.cn/tags/Java%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"/>
    
      <category term="maven" scheme="http://blog.loveyx815.cn/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>前端页面元素内容获取方式</title>
    <link href="http://blog.loveyx815.cn/2020/04/19/summary/%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E5%85%83%E7%B4%A0%E5%86%85%E5%AE%B9%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F/"/>
    <id>http://blog.loveyx815.cn/2020/04/19/summary/%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E5%85%83%E7%B4%A0%E5%86%85%E5%AE%B9%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F/</id>
    <published>2020-04-18T16:00:00.000Z</published>
    <updated>2020-04-19T09:14:24.703Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前端页面元素内容获取方式"><a href="#前端页面元素内容获取方式" class="headerlink" title="前端页面元素内容获取方式"></a>前端页面元素内容获取方式</h1><blockquote><p>主要列举val()，html()，innerHTML()的使用（也是方便自己回顾，刚开始用的少，没太注意区分）</p></blockquote><h3 id="1-val（）获取html元素的value值"><a href="#1-val（）获取html元素的value值" class="headerlink" title="1.val（）获取html元素的value值"></a><strong>1.val（）</strong>获取html元素的value值</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- js获取 --&gt;</span></span><br><span class="line">var v=$("#radio0").val();</span><br><span class="line"><span class="comment">&lt;!--html部分正文 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">id</span>=<span class="string">"radio0"</span> <span class="attr">value</span>=<span class="string">"0"</span>&gt;</span>男<span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">id</span>=<span class="string">"radio1"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span>女<span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动" title="">                </div>                <div class="image-caption">点击并拖拽以移动</div>            </figure><p>上面的<strong>v</strong>打印出来就是“0”</p><h3 id="2-innerHTML-与html-的区别"><a href="#2-innerHTML-与html-的区别" class="headerlink" title="2.innerHTML() 与html( )的区别"></a><strong>2</strong>.innerHTML() 与html( )的区别</h3><p>在一个 HTML 文档中, 我们可以使用 .html() 方法来获取任意一个元素的内容。 如果选择器匹配多于一个的元素，那么只有第一个匹配元素的 HTML 内容会被获取。innerHTML 是从对象的起始位置到终止位置的全部内容,包括Html标签。</p><p>innerHTML（）是js中的写法，html（）是jQuery中的写法。调用方法不一样，前者是xx.innerHTML = “table”，xx.html(“table”)两者实现功能大体相同，都是获取html标签元素内容，通常用来动态生成html页面代码和获取span标签的文本内容。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--js部分 --&gt;</span></span><br><span class="line">var sv=$("#span1").html();</span><br><span class="line"><span class="comment">&lt;!--HTML部分 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"span1"</span>&gt;</span>span文本<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;前端页面元素内容获取方式&quot;&gt;&lt;a href=&quot;#前端页面元素内容获取方式&quot; class=&quot;headerlink&quot; title=&quot;前端页面元素内容获取方式&quot;&gt;&lt;/a&gt;前端页面元素内容获取方式&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;主要列举val()，html()，
      
    
    </summary>
    
    
      <category term="前端" scheme="http://blog.loveyx815.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="JavaScript" scheme="http://blog.loveyx815.cn/tags/JavaScript/"/>
    
      <category term="前端" scheme="http://blog.loveyx815.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
</feed>
